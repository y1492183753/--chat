{"remainingRequest":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\im-ui\\src\\components\\common\\FileUpload.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\im-ui\\src\\components\\common\\FileUpload.vue","mtime":1703809564000},{"path":"D:\\im-ui\\babel.config.js","mtime":1703809560000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1710142166000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJmaWxlVXBsb2FkIiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogbnVsbCwKICAgICAgdXBsb2FkSGVhZGVyczogewogICAgICAgICJhY2Nlc3NUb2tlbiI6IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc1Rva2VuJykKICAgICAgfQogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBhY3Rpb246IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlZDogZmFsc2UKICAgIH0sCiAgICBmaWxlVHlwZXM6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCiAgICBtYXhTaXplOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKICAgIHNob3dMb2FkaW5nOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgZGlzYWJsZWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG9uRmlsZVVwbG9hZChmaWxlKSB7CiAgICAgIC8vIOWxleekuuWKoOi9veadoQogICAgICBpZiAodGhpcy5zaG93TG9hZGluZykgewogICAgICAgIHRoaXMubG9hZGluZyA9IHRoaXMuJGxvYWRpbmcoewogICAgICAgICAgbG9jazogdHJ1ZSwKICAgICAgICAgIHRleHQ6ICfmraPlnKjkuIrkvKAuLi4nLAogICAgICAgICAgc3Bpbm5lcjogJ2VsLWljb24tbG9hZGluZycsCiAgICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgwLCAwLCAwLCAwLjcpJwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLmZpbGUpOwogICAgICB0aGlzLiRodHRwKHsKICAgICAgICB1cmw6IHRoaXMuYWN0aW9uLAogICAgICAgIGRhdGE6IGZvcm1EYXRhLAogICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgdGhpcy4kZW1pdCgic3VjY2VzcyIsIGRhdGEsIGZpbGUuZmlsZSk7CiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIHRoaXMuJGVtaXQoImZhaWwiLCBlLCBmaWxlLmZpbGUpOwogICAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICB0aGlzLmxvYWRpbmcgJiYgdGhpcy5sb2FkaW5nLmNsb3NlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIGJlZm9yZVVwbG9hZChmaWxlKSB7CiAgICAgIC8vIOagoemqjOaWh+S7tuexu+WeiwogICAgICBpZiAodGhpcy5maWxlVHlwZXMgJiYgdGhpcy5maWxlVHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgIGxldCBmaWxlVHlwZSA9IGZpbGUudHlwZTsKICAgICAgICBsZXQgdCA9IHRoaXMuZmlsZVR5cGVzLmZpbmQodCA9PiB0LnRvTG93ZXJDYXNlKCkgPT09IGZpbGVUeXBlKTsKICAgICAgICBpZiAodCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGDmlofku7bmoLzlvI/plJnor6/vvIzor7fkuIrkvKDku6XkuIvmoLzlvI/nmoTmlofku7bvvJoke3RoaXMuZmlsZVR5cGVzLmpvaW4oIuOAgSIpfWApOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyDmoKHpqozlpKflsI8KICAgICAgaWYgKHRoaXMubWF4U2l6ZSAmJiBmaWxlLnNpemUgPiB0aGlzLm1heFNpemUpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGDmlofku7blpKflsI/kuI3og73otoXov4cgJHt0aGlzLmZpbGVTaXplU3RyfSFgKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy4kZW1pdCgiYmVmb3JlIiwgZmlsZSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGZpbGVTaXplU3RyKCkgewogICAgICBpZiAodGhpcy5tYXhTaXplID4gMTAyNCAqIDEwMjQpIHsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLm1heFNpemUgLyAxMDI0IC8gMTAyNCkgKyAiTSI7CiAgICAgIH0KICAgICAgaWYgKHRoaXMubWF4U2l6ZSA+IDEwMjQpIHsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLm1heFNpemUgLyAxMDI0KSArICJLQiI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubWF4U2l6ZSArICJCIjsKICAgIH0KICB9Cn07"},{"version":3,"names":["name","data","loading","uploadHeaders","sessionStorage","getItem","props","action","type","String","required","fileTypes","Array","default","maxSize","Number","showLoading","Boolean","disabled","methods","onFileUpload","file","$loading","lock","text","spinner","background","formData","FormData","append","$http","url","method","headers","then","$emit","catch","e","finally","close","beforeUpload","length","fileType","t","find","toLowerCase","undefined","$message","error","join","size","fileSizeStr","computed","Math","round"],"sources":["src/components/common/FileUpload.vue"],"sourcesContent":["<template>\n\t<el-upload :action=\"'#'\" :http-request=\"onFileUpload\" :accept=\"fileTypes==null?'':fileTypes.join(',')\" :show-file-list=\"false\"\n\t\t:disabled=\"disabled\" :before-upload=\"beforeUpload\">\n\t\t<slot></slot>\n\t</el-upload>\n</template>\n\n<script>\n\texport default {\n\t\tname: \"fileUpload\",\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tloading: null,\n\t\t\t\tuploadHeaders: {\n\t\t\t\t\t\"accessToken\": sessionStorage.getItem('accessToken')\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tprops: {\n\t\t\taction: {\n\t\t\t\ttype: String,\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tfileTypes: {\n\t\t\t\ttype: Array,\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t\tmaxSize: {\n\t\t\t\ttype: Number,\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t\tshowLoading: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonFileUpload(file) {\n\t\t\t\t// 展示加载条\n\t\t\t\tif (this.showLoading) {\n\t\t\t\t\tthis.loading = this.$loading({\n\t\t\t\t\t\tlock: true,\n\t\t\t\t\t\ttext: '正在上传...',\n\t\t\t\t\t\tspinner: 'el-icon-loading',\n\t\t\t\t\t\tbackground: 'rgba(0, 0, 0, 0.7)'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlet formData = new FormData()\n\t\t\t\tformData.append('file', file.file)\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: this.action,\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((data) => {\n\t\t\t\t\tthis.$emit(\"success\", data, file.file);\n\t\t\t\t}).catch((e) => {\n\t\t\t\t\tthis.$emit(\"fail\", e, file.file);\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tthis.loading && this.loading.close();\n\t\t\t\t})\n\t\t\t},\n\t\t\tbeforeUpload(file) {\n\t\t\t\t// 校验文件类型\n\t\t\t\tif (this.fileTypes && this.fileTypes.length > 0) {\n\t\t\t\t\tlet fileType = file.type;\n\t\t\t\t\tlet t = this.fileTypes.find((t) => t.toLowerCase() === fileType);\n\t\t\t\t\tif (t === undefined) {\n\t\t\t\t\t\tthis.$message.error(`文件格式错误，请上传以下格式的文件：${this.fileTypes.join(\"、\")}`);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// 校验大小\n\t\t\t\tif (this.maxSize && file.size > this.maxSize) {\n\t\t\t\t\tthis.$message.error(`文件大小不能超过 ${this.fileSizeStr}!`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.$emit(\"before\", file);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tfileSizeStr() {\n\t\t\t\tif (this.maxSize > 1024 * 1024) {\n\t\t\t\t\treturn Math.round(this.maxSize / 1024 / 1024) + \"M\";\n\t\t\t\t}\n\t\t\t\tif (this.maxSize > 1024) {\n\t\t\t\t\treturn Math.round(this.maxSize / 1024) + \"KB\";\n\t\t\t\t}\n\t\t\t\treturn this.maxSize + \"B\";\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n</style>"],"mappings":"AAQA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,OAAA;MACAC,aAAA;QACA,eAAAC,cAAA,CAAAC,OAAA;MACA;IACA;EACA;EACAC,KAAA;IACAC,MAAA;MACAC,IAAA,EAAAC,MAAA;MACAC,QAAA;IACA;IACAC,SAAA;MACAH,IAAA,EAAAI,KAAA;MACAC,OAAA;IACA;IACAC,OAAA;MACAN,IAAA,EAAAO,MAAA;MACAF,OAAA;IACA;IACAG,WAAA;MACAR,IAAA,EAAAS,OAAA;MACAJ,OAAA;IACA;IACAK,QAAA;MACAV,IAAA,EAAAS,OAAA;MACAJ,OAAA;IACA;EACA;EACAM,OAAA;IACAC,aAAAC,IAAA;MACA;MACA,SAAAL,WAAA;QACA,KAAAd,OAAA,QAAAoB,QAAA;UACAC,IAAA;UACAC,IAAA;UACAC,OAAA;UACAC,UAAA;QACA;MACA;MAEA,IAAAC,QAAA,OAAAC,QAAA;MACAD,QAAA,CAAAE,MAAA,SAAAR,IAAA,CAAAA,IAAA;MACA,KAAAS,KAAA;QACAC,GAAA,OAAAxB,MAAA;QACAN,IAAA,EAAA0B,QAAA;QACAK,MAAA;QACAC,OAAA;UACA;QACA;MACA,GAAAC,IAAA,CAAAjC,IAAA;QACA,KAAAkC,KAAA,YAAAlC,IAAA,EAAAoB,IAAA,CAAAA,IAAA;MACA,GAAAe,KAAA,CAAAC,CAAA;QACA,KAAAF,KAAA,SAAAE,CAAA,EAAAhB,IAAA,CAAAA,IAAA;MACA,GAAAiB,OAAA;QACA,KAAApC,OAAA,SAAAA,OAAA,CAAAqC,KAAA;MACA;IACA;IACAC,aAAAnB,IAAA;MACA;MACA,SAAAV,SAAA,SAAAA,SAAA,CAAA8B,MAAA;QACA,IAAAC,QAAA,GAAArB,IAAA,CAAAb,IAAA;QACA,IAAAmC,CAAA,QAAAhC,SAAA,CAAAiC,IAAA,CAAAD,CAAA,IAAAA,CAAA,CAAAE,WAAA,OAAAH,QAAA;QACA,IAAAC,CAAA,KAAAG,SAAA;UACA,KAAAC,QAAA,CAAAC,KAAA,2BAAArC,SAAA,CAAAsC,IAAA;UACA;QACA;MACA;MACA;MACA,SAAAnC,OAAA,IAAAO,IAAA,CAAA6B,IAAA,QAAApC,OAAA;QACA,KAAAiC,QAAA,CAAAC,KAAA,kBAAAG,WAAA;QACA;MACA;MAEA,KAAAhB,KAAA,WAAAd,IAAA;MACA;IACA;EACA;EACA+B,QAAA;IACAD,YAAA;MACA,SAAArC,OAAA;QACA,OAAAuC,IAAA,CAAAC,KAAA,MAAAxC,OAAA;MACA;MACA,SAAAA,OAAA;QACA,OAAAuC,IAAA,CAAAC,KAAA,MAAAxC,OAAA;MACA;MACA,YAAAA,OAAA;IACA;EACA;AACA","ignoreList":[]}]}