{"remainingRequest":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\im-ui\\node_modules\\eslint-loader\\index.js??ref--14-0!D:\\im-ui\\src\\store\\friendStore.js","dependencies":[{"path":"D:\\im-ui\\src\\store\\friendStore.js","mtime":1703809564000},{"path":"D:\\im-ui\\babel.config.js","mtime":1703809560000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1710142166000},{"path":"D:\\im-ui\\node_modules\\eslint-loader\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBodHRwIGZyb20gJy4uL2FwaS9odHRwUmVxdWVzdC5qcyc7CmltcG9ydCB7IFRFUk1JTkFMX1RZUEUgfSBmcm9tICIuLi9hcGkvZW51bXMuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgc3RhdGU6IHsKICAgIGZyaWVuZHM6IFtdLAogICAgYWN0aXZlRnJpZW5kOiBudWxsLAogICAgdGltZXI6IG51bGwKICB9LAogIG11dGF0aW9uczogewogICAgc2V0RnJpZW5kcyhzdGF0ZSwgZnJpZW5kcykgewogICAgICBzdGF0ZS5mcmllbmRzID0gZnJpZW5kczsKICAgIH0sCiAgICB1cGRhdGVGcmllbmQoc3RhdGUsIGZyaWVuZCkgewogICAgICBzdGF0ZS5mcmllbmRzLmZvckVhY2goKGYsIGluZGV4KSA9PiB7CiAgICAgICAgaWYgKGYuaWQgPT0gZnJpZW5kLmlkKSB7CiAgICAgICAgICAvLyDmi7fotJ3lsZ7mgKcKICAgICAgICAgIGxldCBvbmxpbmUgPSBzdGF0ZS5mcmllbmRzW2luZGV4XS5vbmxpbmU7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHN0YXRlLmZyaWVuZHNbaW5kZXhdLCBmcmllbmQpOwogICAgICAgICAgc3RhdGUuZnJpZW5kc1tpbmRleF0ub25saW5lID0gb25saW5lOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWN0aXZlRnJpZW5kKHN0YXRlLCBpZHgpIHsKICAgICAgc3RhdGUuYWN0aXZlRnJpZW5kID0gc3RhdGUuZnJpZW5kc1tpZHhdOwogICAgfSwKICAgIHJlbW92ZUZyaWVuZChzdGF0ZSwgaWR4KSB7CiAgICAgIGlmIChzdGF0ZS5mcmllbmRzW2lkeF0gPT0gc3RhdGUuYWN0aXZlRnJpZW5kKSB7CiAgICAgICAgc3RhdGUuYWN0aXZlRnJpZW5kID0gbnVsbDsKICAgICAgfQogICAgICBzdGF0ZS5mcmllbmRzLnNwbGljZShpZHgsIDEpOwogICAgfSwKICAgIGFkZEZyaWVuZChzdGF0ZSwgZnJpZW5kKSB7CiAgICAgIHN0YXRlLmZyaWVuZHMucHVzaChmcmllbmQpOwogICAgfSwKICAgIHJlZnJlc2hPbmxpbmVTdGF0dXMoc3RhdGUpIHsKICAgICAgbGV0IHVzZXJJZHMgPSBbXTsKICAgICAgaWYgKHN0YXRlLmZyaWVuZHMubGVuZ3RoID09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3RhdGUuZnJpZW5kcy5mb3JFYWNoKGYgPT4gewogICAgICAgIHVzZXJJZHMucHVzaChmLmlkKTsKICAgICAgfSk7CiAgICAgIGh0dHAoewogICAgICAgIHVybDogJy91c2VyL3Rlcm1pbmFsL29ubGluZScsCiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIHVzZXJJZHM6IHVzZXJJZHMuam9pbignLCcpCiAgICAgICAgfQogICAgICB9KS50aGVuKG9ubGluZVRlcm1pbmFscyA9PiB7CiAgICAgICAgdGhpcy5jb21taXQoInNldE9ubGluZVN0YXR1cyIsIG9ubGluZVRlcm1pbmFscyk7CiAgICAgIH0pOwoKICAgICAgLy8gMzBz5ZCO6YeN5paw5ouJ5Y+WCiAgICAgIGNsZWFyVGltZW91dChzdGF0ZS50aW1lcik7CiAgICAgIHN0YXRlLnRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5jb21taXQoInJlZnJlc2hPbmxpbmVTdGF0dXMiKTsKICAgICAgfSwgMzAwMDApOwogICAgfSwKICAgIHNldE9ubGluZVN0YXR1cyhzdGF0ZSwgb25saW5lVGVybWluYWxzKSB7CiAgICAgIHN0YXRlLmZyaWVuZHMuZm9yRWFjaChmID0+IHsKICAgICAgICBsZXQgdXNlclRlcm1pbmFsID0gb25saW5lVGVybWluYWxzLmZpbmQobyA9PiBmLmlkID09IG8udXNlcklkKTsKICAgICAgICBpZiAodXNlclRlcm1pbmFsKSB7CiAgICAgICAgICBmLm9ubGluZSA9IHRydWU7CiAgICAgICAgICBmLm9ubGluZVRlcm1pbmFscyA9IHVzZXJUZXJtaW5hbC50ZXJtaW5hbHM7CiAgICAgICAgICBmLm9ubGluZVdlYiA9IHVzZXJUZXJtaW5hbC50ZXJtaW5hbHMuaW5kZXhPZihURVJNSU5BTF9UWVBFLldFQikgPj0gMDsKICAgICAgICAgIGYub25saW5lQXBwID0gdXNlclRlcm1pbmFsLnRlcm1pbmFscy5pbmRleE9mKFRFUk1JTkFMX1RZUEUuQVBQKSA+PSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmLm9ubGluZSA9IGZhbHNlOwogICAgICAgICAgZi5vbmxpbmVUZXJtaW5hbHMgPSBbXTsKICAgICAgICAgIGYub25saW5lV2ViID0gZmFsc2U7CiAgICAgICAgICBmLm9ubGluZUFwcCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8vIOWcqOe6v+eahOWcqOWJjemdogogICAgICBzdGF0ZS5mcmllbmRzLnNvcnQoKGYxLCBmMikgPT4gewogICAgICAgIGlmIChmMS5vbmxpbmUgJiYgIWYyLm9ubGluZSkgewogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBpZiAoZjIub25saW5lICYmICFmMS5vbmxpbmUpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgICAgfSk7CiAgICB9LAogICAgY2xlYXIoc3RhdGUpIHsKICAgICAgY2xlYXJUaW1lb3V0KHN0YXRlLnRpbWVyKTsKICAgICAgc3RhdGUuZnJpZW5kcyA9IFtdOwogICAgICBzdGF0ZS50aW1lciA9IG51bGw7CiAgICAgIHN0YXRlLmFjdGl2ZUZyaWVuZCA9IFtdOwogICAgfQogIH0sCiAgYWN0aW9uczogewogICAgbG9hZEZyaWVuZChjb250ZXh0KSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgaHR0cCh7CiAgICAgICAgICB1cmw6ICcvZnJpZW5kL2xpc3QnLAogICAgICAgICAgbWV0aG9kOiAnR0VUJwogICAgICAgIH0pLnRoZW4oZnJpZW5kcyA9PiB7CiAgICAgICAgICBjb250ZXh0LmNvbW1pdCgic2V0RnJpZW5kcyIsIGZyaWVuZHMpOwogICAgICAgICAgY29udGV4dC5jb21taXQoInJlZnJlc2hPbmxpbmVTdGF0dXMiKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCJsb2FkRnJpZW5kIik7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSkuY2F0Y2gocmVzID0+IHsKICAgICAgICAgIHJlamVjdCgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"names":["http","TERMINAL_TYPE","state","friends","activeFriend","timer","mutations","setFriends","updateFriend","friend","forEach","f","index","id","online","Object","assign","idx","removeFriend","splice","addFriend","push","refreshOnlineStatus","userIds","length","url","method","params","join","then","onlineTerminals","commit","clearTimeout","setTimeout","setOnlineStatus","userTerminal","find","o","userId","terminals","onlineWeb","indexOf","WEB","onlineApp","APP","sort","f1","f2","clear","actions","loadFriend","context","Promise","resolve","reject","console","log","catch","res"],"sources":["D:/im-ui/src/store/friendStore.js"],"sourcesContent":["import http from '../api/httpRequest.js'\nimport {TERMINAL_TYPE} from \"../api/enums.js\"\n\nexport default {\n\n\tstate: {\n\t\tfriends: [],\n\t\tactiveFriend: null,\n\t\ttimer: null\n\t},\n\tmutations: {\n\t\tsetFriends(state, friends) {\n\t\t\tstate.friends = friends;\n\t\t},\n\t\tupdateFriend(state,friend){\n\t\t\tstate.friends.forEach((f,index)=>{\n\t\t\t\tif(f.id==friend.id){\n\t\t\t\t\t// 拷贝属性\n\t\t\t\t\tlet online = state.friends[index].online;\n\t\t\t\t\tObject.assign(state.friends[index], friend);\n\t\t\t\t\tstate.friends[index].online =online;\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tactiveFriend(state, idx) {\n\t\t\tstate.activeFriend = state.friends[idx];\n\t\t},\n\t\tremoveFriend(state, idx) {\n\t\t\tif (state.friends[idx] == state.activeFriend) {\n\t\t\t\tstate.activeFriend = null;\n\t\t\t}\n\t\t\tstate.friends.splice(idx, 1);\n\t\t},\n\t\taddFriend(state, friend) {\n\t\t\tstate.friends.push(friend);\n\t\t},\n\t\trefreshOnlineStatus(state){\n\t\t\tlet userIds = [];\n\t\t\tif(state.friends.length ==0){\n\t\t\t\treturn; \n\t\t\t}\n\t\t\tstate.friends.forEach((f)=>{userIds.push(f.id)});\n\t\t\thttp({\n\t\t\t\turl: '/user/terminal/online',\n\t\t\t\tmethod: 'get',\n\t\t\t\tparams: {userIds: userIds.join(',')}\n\t\t\t}).then((onlineTerminals) => {\n\t\t\t\tthis.commit(\"setOnlineStatus\",onlineTerminals);\n\t\t\t})\n\t\t\t\n\t\t\t// 30s后重新拉取\n\t\t\tclearTimeout(state.timer);\n\t\t\tstate.timer = setTimeout(()=>{\n\t\t\t\tthis.commit(\"refreshOnlineStatus\");\n\t\t\t},30000)\n\t\t},\n\t\tsetOnlineStatus(state,onlineTerminals){\n\t\t\tstate.friends.forEach((f)=>{\n\t\t\t\tlet userTerminal = onlineTerminals.find((o)=> f.id==o.userId);\n\t\t\t\tif(userTerminal){\n\t\t\t\t\tf.online = true;\n\t\t\t\t\tf.onlineTerminals = userTerminal.terminals;\n\t\t\t\t\tf.onlineWeb = userTerminal.terminals.indexOf(TERMINAL_TYPE.WEB)>=0\n\t\t\t\t\tf.onlineApp = userTerminal.terminals.indexOf(TERMINAL_TYPE.APP)>=0\n\t\t\t\t}else{\n\t\t\t\t\tf.online = false;\n\t\t\t\t\tf.onlineTerminals = [];\n\t\t\t\t\tf.onlineWeb = false;\n\t\t\t\t\tf.onlineApp = false;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// 在线的在前面\n\t\t\tstate.friends.sort((f1,f2)=>{\n\t\t\t\tif(f1.online&&!f2.online){\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif(f2.online&&!f1.online){\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t},\n\t\tclear(state) {\n\t\t\tclearTimeout(state.timer);\n\t\t\tstate.friends = [];\n\t\t\tstate.timer = null;\n\t\t\tstate.activeFriend = [];\n\t\t}\n\t},\n\tactions: {\n\t\tloadFriend(context) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\thttp({\n\t\t\t\t\turl: '/friend/list',\n\t\t\t\t\tmethod: 'GET'\n\t\t\t\t}).then((friends) => {\n\t\t\t\t\tcontext.commit(\"setFriends\", friends);\n\t\t\t\t\tcontext.commit(\"refreshOnlineStatus\");\n\t\t\t\t\tconsole.log(\"loadFriend\")\n\t\t\t\t\tresolve()\n\t\t\t\t}).catch((res) => {\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}]}