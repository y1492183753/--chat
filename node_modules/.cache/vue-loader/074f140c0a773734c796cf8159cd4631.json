{"remainingRequest":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\im-ui\\src\\view\\Friend.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\im-ui\\src\\view\\Friend.vue","mtime":1710937124686},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1710142166000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CglpbXBvcnQgRnJpZW5kSXRlbSBmcm9tICIuLi9jb21wb25lbnRzL2ZyaWVuZC9GcmllbmRJdGVtLnZ1ZSI7CglpbXBvcnQgQWRkRnJpZW5kIGZyb20gIi4uL2NvbXBvbmVudHMvZnJpZW5kL0FkZEZyaWVuZC52dWUiOwoJaW1wb3J0IEhlYWRJbWFnZSBmcm9tICIuLi9jb21wb25lbnRzL2NvbW1vbi9IZWFkSW1hZ2UudnVlIjsKCglleHBvcnQgZGVmYXVsdCB7CgkJbmFtZTogImZyaWVuZCIsCgkJY29tcG9uZW50czogewoJCQlGcmllbmRJdGVtLAoJCQlBZGRGcmllbmQsCgkJCUhlYWRJbWFnZQoKCQl9LAoJCWRhdGEoKSB7CgkJCXJldHVybiB7CgkJCQlzZWFyY2hUZXh0OiAiIiwKCQkJCXNob3dBZGRGcmllbmQ6IGZhbHNlLAoJCQkJYWN0aXZlSWR4OiAtMSwKCQkJCXVzZXJJbmZvOiB7fQoJCQl9CgkJfSwKCQltZXRob2RzOiB7CgkJCW9uU2hvd0FkZEZyaWVuZCgpIHsKCQkJCXRoaXMuc2hvd0FkZEZyaWVuZCA9IHRydWU7CgkJCX0sCgkJCW9uQ2xvc2VBZGRGcmllbmQoKSB7CgkJCQl0aGlzLnNob3dBZGRGcmllbmQgPSBmYWxzZTsKCQkJfSwKCQkJb25BY3RpdmVJdGVtKGZyaWVuZCwgaWR4KSB7CgkJCQl0aGlzLiRzdG9yZS5jb21taXQoImFjdGl2ZUZyaWVuZCIsIGlkeCk7CgkJCQl0aGlzLmFjdGl2ZUlkeCA9IGlkeAoJCQkJdGhpcy5sb2FkVXNlckluZm8oZnJpZW5kLCBpZHgpOwoJCQl9LAoJCQlvbkRlbEl0ZW0oZnJpZW5kLCBpZHgpIHsKCQkJCXRoaXMuJGNvbmZpcm0oYOehruiupOimgeino+mZpOS4jiAnJHtmcmllbmQubmlja05hbWV9J+eahOWlveWPi+WFs+ezu+WQlz9gLCAn56Gu6K6k6Kej6ZmkPycsIHsKCQkJCQljb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCgkJCQkJY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCgkJCQkJdHlwZTogJ3dhcm5pbmcnCgkJCQl9KS50aGVuKCgpID0+IHsKCQkJCQl0aGlzLiRodHRwKHsKCQkJCQkJdXJsOiBgL2ZyaWVuZC9kZWxldGUvJHtmcmllbmQuaWR9YCwKCQkJCQkJbWV0aG9kOiAnZGVsZXRlJwoJCQkJCX0pLnRoZW4oKGRhdGEpID0+IHsKCQkJCQkJdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLliKDpmaTlpb3lj4vmiJDlip8iKTsKCQkJCQkJdGhpcy4kc3RvcmUuY29tbWl0KCJyZW1vdmVGcmllbmQiLCBpZHgpOwoJCQkJCQl0aGlzLiRzdG9yZS5jb21taXQoInJlbW92ZVByaXZhdGVDaGF0IiwgZnJpZW5kLmlkKTsKCQkJCQl9KQoJCQkJfSkKCQkJfSwKCQkJb25BZGRGcmllbmQodXNlcil7CgkJCQl0aGlzLiRodHRwKHsKCQkJCQl1cmw6ICIvZnJpZW5kL2FkZCIsCgkJCQkJbWV0aG9kOiAicG9zdCIsCgkJCQkJcGFyYW1zOiB7CgkJCQkJCWZyaWVuZElkOiB1c2VyLmlkCgkJCQkJfQoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCXRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5re75Yqg5oiQ5Yqf77yM5a+55pa55bey5oiQ5Li65oKo55qE5aW95Y+LIik7CgkJCQkJbGV0IGZyaWVuZCA9IHsKCQkJCQkJaWQ6dXNlci5pZCwKCQkJCQkJbmlja05hbWU6IHVzZXIubmlja05hbWUsCgkJCQkJCWhlYWRJbWFnZTogdXNlci5oZWFkSW1hZ2UsCgkJCQkJCW9ubGluZTogdXNlci5vbmxpbmUKCQkJCQl9CgkJCQkJdGhpcy4kc3RvcmUuY29tbWl0KCJhZGRGcmllbmQiLGZyaWVuZCk7CgkJCQl9KQoJCQl9LAoJCQlvblNlbmRNZXNzYWdlKHVzZXIpIHsKCQkJCWxldCBjaGF0ID0gewoJCQkJCXR5cGU6ICdQUklWQVRFJywKCQkJCQl0YXJnZXRJZDogdXNlci5pZCwKCQkJCQlzaG93TmFtZTogdXNlci5uaWNrTmFtZSwKCQkJCQloZWFkSW1hZ2U6IHVzZXIuaGVhZEltYWdlLAoJCQkJfTsKCQkJCXRoaXMuJHN0b3JlLmNvbW1pdCgib3BlbkNoYXQiLCBjaGF0KTsKCQkJCXRoaXMuJHN0b3JlLmNvbW1pdCgiYWN0aXZlQ2hhdCIsIDApOwoJCQkJdGhpcy4kcm91dGVyLnB1c2goIi9ob21lL2NoYXQiKTsKCQkJfSwKCQkJc2hvd0Z1bGxJbWFnZSgpIHsKCQkJCWlmICh0aGlzLnVzZXJJbmZvLmhlYWRJbWFnZSkgewoJCQkJCXRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd0Z1bGxJbWFnZUJveCcsIHRoaXMudXNlckluZm8uaGVhZEltYWdlKTsKCQkJCX0KCQkJfSwKCQkJdXBkYXRlRnJpZW5kSW5mbyhmcmllbmQsIHVzZXIsIGluZGV4KSB7CgkJCQkvLyBzdG9yZeeahOaVsOaNruS4jeiDveebtOaOpeS/ruaUue+8jOa3seaLt+i0neS4gOS7vXN0b3Jl55qE5pWw5o2uCgkJCQlmcmllbmQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZyaWVuZCkpOwoJCQkJZnJpZW5kLmhlYWRJbWFnZSA9IHVzZXIuaGVhZEltYWdlVGh1bWI7CgkJCQlmcmllbmQubmlja05hbWUgPSB1c2VyLm5pY2tOYW1lOwoJCQkJdGhpcy4kaHR0cCh7CgkJCQkJdXJsOiAiL2ZyaWVuZC91cGRhdGUiLAoJCQkJCW1ldGhvZDogInB1dCIsCgkJCQkJZGF0YTogZnJpZW5kCgkJCQl9KS50aGVuKCgpID0+IHsKCQkJCQl0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZUZyaWVuZCIsIGZyaWVuZCk7CgkJCQkJdGhpcy4kc3RvcmUuY29tbWl0KCJ1cGRhdGVDaGF0RnJvbUZyaWVuZCIsIHVzZXIpOwoJCQkJfSkKCQkJfSwKCQkJbG9hZFVzZXJJbmZvKGZyaWVuZCwgaW5kZXgpIHsKCQkJCXRoaXMuJGh0dHAoewoJCQkJCXVybDogYC91c2VyL2ZpbmQvJHtmcmllbmQuaWR9YCwKCQkJCQltZXRob2Q6ICdnZXQnCgkJCQl9KS50aGVuKCh1c2VyKSA9PiB7CgkJCQkJdGhpcy51c2VySW5mbyA9IHVzZXI7CgkJCQkJLy8g5aaC5p6c5Y+R546w5aW95Y+L55qE5aS05YOP5ZKM5pi156ew5pS55LqG77yM6L+b6KGM5pu05pawCgkJCQkJaWYgKHVzZXIuaGVhZEltYWdlVGh1bWIgIT0gZnJpZW5kLmhlYWRJbWFnZSB8fAoJCQkJCQl1c2VyLm5pY2tOYW1lICE9IGZyaWVuZC5uaWNrTmFtZSkgewoJCQkJCQl0aGlzLnVwZGF0ZUZyaWVuZEluZm8oZnJpZW5kLCB1c2VyLCBpbmRleCkKCQkJCQl9CgkJCQl9KQoJCQl9CgkJfSwKCQljb21wdXRlZDogewoJCQlmcmllbmRTdG9yZSgpIHsKCQkJCXJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5mcmllbmRTdG9yZTsKCQkJfSwKCQkJaXNGcmllbmQoKXsKCQkJCXJldHVybiB0aGlzLmZyaWVuZFN0b3JlLmZyaWVuZHMuZmluZCgoZik9PmYuaWQ9PXRoaXMudXNlckluZm8uaWQpOwoJCQl9CgkJfQoJfQo="},{"version":3,"sources":["Friend.vue"],"names":[],"mappings":";AA4DA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Friend.vue","sourceRoot":"src/view","sourcesContent":["<template>\n\t<el-container class=\"friend-page\">\n\t\t<el-aside width=\"260px\" class=\"friend-list-box\">\n\t\t\t<div class=\"friend-list-header\">\n\t\t\t\t<div class=\"friend-list-search\">\n\t\t\t\t\t<el-input width=\"200px\" placeholder=\"搜索好友\" v-model=\"searchText\">\n\t\t\t\t\t\t<el-button slot=\"append\" icon=\"el-icon-search\"></el-button>\n\t\t\t\t\t</el-input>\n\t\t\t\t</div>\n\t\t\t\t<el-button plain icon=\"el-icon-plus\" style=\"border: none; padding:12px; font-size: 20px;color: black;\"\n\t\t\t\t\ttitle=\"添加好友\" @click=\"onShowAddFriend()\"></el-button>\n\t\t\t\t<add-friend :dialogVisible=\"showAddFriend\" @close=\"onCloseAddFriend\">\n\t\t\t\t</add-friend>\n\t\t\t</div>\n\t\t\t<el-scrollbar class=\"friend-list-items\">\n\t\t\t\t<div v-for=\"(friend,index) in $store.state.friendStore.friends\" :key=\"index\">\n\t\t\t\t\t<friend-item v-show=\"friend.nickName.startsWith(searchText)\"  :index=\"index\"\n\t\t\t\t\t\t:active=\"friend === $store.state.friendStore.activeFriend\" @chat=\"onSendMessage(friend)\"\n\t\t\t\t\t\t@delete=\"onDelItem(friend,index)\" @click.native=\"onActiveItem(friend,index)\">\n\t\t\t\t\t</friend-item>\n\t\t\t\t</div>\n\t\t\t</el-scrollbar>\n\t\t</el-aside>\n\t\t<el-container class=\"friend-box\">\n\t\t\t<div class=\"friend-header\" v-show=\"userInfo.id\">\n\t\t\t\t{{userInfo.nickName}}\n\t\t\t</div>\n\t\t\t<div v-show=\"userInfo.id\">\n\t\t\t\t<div class=\"friend-detail\">\n\t\t\t\t\t<head-image  :size=\"200\" \n\t\t\t\t\t\t:name=\"userInfo.nickName\"\n\t\t\t\t\t\t:url=\"userInfo.headImage\"\n\t\t\t\t\t\t@click.native=\"showFullImage()\"></head-image>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"info-item\">\n\t\t\t\t\t\t\t<el-descriptions title=\"好友信息\" class=\"description\" :column=\"1\">\n\t\t\t\t\t\t\t\t<el-descriptions-item label=\"用户名\">{{ userInfo.userName }}\n\t\t\t\t\t\t\t\t</el-descriptions-item>\n\t\t\t\t\t\t\t\t<el-descriptions-item label=\"昵称\">{{ userInfo.nickName }}\n\t\t\t\t\t\t\t\t</el-descriptions-item>\n\t\t\t\t\t\t\t\t<el-descriptions-item label=\"性别\">{{ userInfo.sex==0?\"男\":\"女\" }}</el-descriptions-item>\n\t\t\t\t\t\t\t\t<el-descriptions-item label=\"签名\">{{ userInfo.signature }}</el-descriptions-item>\n\t\t\t\t\t\t\t</el-descriptions>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"frient-btn-group\">\n\t\t\t\t\t\t\t<el-button v-show=\"isFriend\" icon=\"el-icon-chat-dot-round\" type=\"primary\"  @click=\"onSendMessage(userInfo)\">发送消息</el-button>\n\t\t\t\t\t\t\t<el-button v-show=\"!isFriend\" icon=\"el-icon-plus\" type=\"primary\"  @click=\"onAddFriend(userInfo)\">加为好友</el-button>\n\t\t\t\t\t\t\t<el-button v-show=\"isFriend\" icon=\"el-icon-delete\"  type=\"danger\" @click=\"onDelItem(userInfo,activeIdx)\">删除好友</el-button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<el-divider content-position=\"center\"></el-divider>\n\t\t\t\t\n\t\t\t</div>\n\t\t</el-container>\n\t</el-container>\n</template>\n\n<script>\n\timport FriendItem from \"../components/friend/FriendItem.vue\";\n\timport AddFriend from \"../components/friend/AddFriend.vue\";\n\timport HeadImage from \"../components/common/HeadImage.vue\";\n\n\texport default {\n\t\tname: \"friend\",\n\t\tcomponents: {\n\t\t\tFriendItem,\n\t\t\tAddFriend,\n\t\t\tHeadImage\n\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tsearchText: \"\",\n\t\t\t\tshowAddFriend: false,\n\t\t\t\tactiveIdx: -1,\n\t\t\t\tuserInfo: {}\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonShowAddFriend() {\n\t\t\t\tthis.showAddFriend = true;\n\t\t\t},\n\t\t\tonCloseAddFriend() {\n\t\t\t\tthis.showAddFriend = false;\n\t\t\t},\n\t\t\tonActiveItem(friend, idx) {\n\t\t\t\tthis.$store.commit(\"activeFriend\", idx);\n\t\t\t\tthis.activeIdx = idx\n\t\t\t\tthis.loadUserInfo(friend, idx);\n\t\t\t},\n\t\t\tonDelItem(friend, idx) {\n\t\t\t\tthis.$confirm(`确认要解除与 '${friend.nickName}'的好友关系吗?`, '确认解除?', {\n\t\t\t\t\tconfirmButtonText: '确定',\n\t\t\t\t\tcancelButtonText: '取消',\n\t\t\t\t\ttype: 'warning'\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.$http({\n\t\t\t\t\t\turl: `/friend/delete/${friend.id}`,\n\t\t\t\t\t\tmethod: 'delete'\n\t\t\t\t\t}).then((data) => {\n\t\t\t\t\t\tthis.$message.success(\"删除好友成功\");\n\t\t\t\t\t\tthis.$store.commit(\"removeFriend\", idx);\n\t\t\t\t\t\tthis.$store.commit(\"removePrivateChat\", friend.id);\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\tonAddFriend(user){\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: \"/friend/add\",\n\t\t\t\t\tmethod: \"post\",\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfriendId: user.id\n\t\t\t\t\t}\n\t\t\t\t}).then((data) => {\n\t\t\t\t\tthis.$message.success(\"添加成功，对方已成为您的好友\");\n\t\t\t\t\tlet friend = {\n\t\t\t\t\t\tid:user.id,\n\t\t\t\t\t\tnickName: user.nickName,\n\t\t\t\t\t\theadImage: user.headImage,\n\t\t\t\t\t\tonline: user.online\n\t\t\t\t\t}\n\t\t\t\t\tthis.$store.commit(\"addFriend\",friend);\n\t\t\t\t})\n\t\t\t},\n\t\t\tonSendMessage(user) {\n\t\t\t\tlet chat = {\n\t\t\t\t\ttype: 'PRIVATE',\n\t\t\t\t\ttargetId: user.id,\n\t\t\t\t\tshowName: user.nickName,\n\t\t\t\t\theadImage: user.headImage,\n\t\t\t\t};\n\t\t\t\tthis.$store.commit(\"openChat\", chat);\n\t\t\t\tthis.$store.commit(\"activeChat\", 0);\n\t\t\t\tthis.$router.push(\"/home/chat\");\n\t\t\t},\n\t\t\tshowFullImage() {\n\t\t\t\tif (this.userInfo.headImage) {\n\t\t\t\t\tthis.$store.commit('showFullImageBox', this.userInfo.headImage);\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateFriendInfo(friend, user, index) {\n\t\t\t\t// store的数据不能直接修改，深拷贝一份store的数据\n\t\t\t\tfriend = JSON.parse(JSON.stringify(friend));\n\t\t\t\tfriend.headImage = user.headImageThumb;\n\t\t\t\tfriend.nickName = user.nickName;\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: \"/friend/update\",\n\t\t\t\t\tmethod: \"put\",\n\t\t\t\t\tdata: friend\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.$store.commit(\"updateFriend\", friend);\n\t\t\t\t\tthis.$store.commit(\"updateChatFromFriend\", user);\n\t\t\t\t})\n\t\t\t},\n\t\t\tloadUserInfo(friend, index) {\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: `/user/find/${friend.id}`,\n\t\t\t\t\tmethod: 'get'\n\t\t\t\t}).then((user) => {\n\t\t\t\t\tthis.userInfo = user;\n\t\t\t\t\t// 如果发现好友的头像和昵称改了，进行更新\n\t\t\t\t\tif (user.headImageThumb != friend.headImage ||\n\t\t\t\t\t\tuser.nickName != friend.nickName) {\n\t\t\t\t\t\tthis.updateFriendInfo(friend, user, index)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tfriendStore() {\n\t\t\t\treturn this.$store.state.friendStore;\n\t\t\t},\n\t\t\tisFriend(){\n\t\t\t\treturn this.friendStore.friends.find((f)=>f.id==this.userInfo.id);\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped lang=\"scss\">\n\t.friend-page {\n\t\t.friend-list-box {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tborder: #ffffff solid 1px;\n\t\t\tbackground: white;\n\t\t\tbox-shadow: 2px 5px 2px #22222275;\n\n\t\t\t.friend-list-header {\n\t\t\t\theight: 50px;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding: 5px;\n\t\t\t\tbackground-color: white;\n\n\t\t\t\t.friend-list-search {\n\t\t\t\t\tflex: 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.friend-list-items {\n\t\t\t\tflex: 1;\n\t\t\t}\n\t\t}\n\n\t\t.friend-box {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tborder: #dddddd solid 1px;\n\n\t\t\t.friend-header {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 50px;\n\t\t\t\tpadding: 5px;\n\t\t\t\tline-height: 50px;\n\t\t\t\tfont-size: 20px;\n\t\t\t\ttext-align: left;\n\t\t\t\ttext-indent: 10px;\n\t\t\t\tfont-weight: 600;\n\t\t\t\tbackground-color: white;\n\t\t\t\tborder: #ffffff solid 1px;\n\t\t\t}\n\n\t\t\t.friend-detail {\n\t\t\t\tdisplay: flex;\n\t\t\t\tpadding: 50px 80px 20px 80px;\n\t\t\t\ttext-align: center;\n\n\t\t\t\t.info-item {\n\t\t\t\t\tmargin-left: 20px;\n\t\t\t\t\tbackground-color: #ffffff;\n\t\t\t\t}\n\n\t\t\t\t.description {\n\t\t\t\t\tpadding: 20px 20px 0px 20px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.frient-btn-group {\n\t\t\t\ttext-align: left !important;\n\t\t\t\tpadding: 20px;\n\t\t\t}\n\t\t}\n\t}\n</style>"]}]}