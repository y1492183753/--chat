{"remainingRequest":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\im-ui\\src\\components\\chat\\ChatVoice.vue?vue&type=style&index=0&id=5129a733&lang=scss","dependencies":[{"path":"D:\\im-ui\\src\\components\\chat\\ChatVoice.vue","mtime":1703809564000},{"path":"D:\\im-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1710142168000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1710142168000},{"path":"D:\\im-ui\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jaGF0LXZvaWNlIHsKCgkuY2hhdC12b2ljZS10aXAgewoJCWZvbnQtc2l6ZTogMThweDsKCX0KCgkuY2hhdC12b2ljZS1idG4tZ3JvdXAgewoJCW1hcmdpbi1ib3R0b206IDIwcHg7Cgl9Cn0K"},{"version":3,"sources":["ChatVoice.vue"],"names":[],"mappings":";AA+IA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"ChatVoice.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n\t<el-dialog class=\"chat-voice\" title=\"语音录制\" :visible.sync=\"visible\" width=\"600px\" :before-close=\"onClose\">\n\t\t<div v-show=\"mode=='RECORD'\">\n\t\t\t<div class=\"chat-voice-tip\">{{stateTip}}</div>\n\t\t\t<div>时长: {{state=='STOP'?0:parseInt(rc.duration)}}s</div>\n\t\t</div>\n\t\t<audio v-show=\"mode=='PLAY'\" :src=\"url\" controls ref=\"audio\" @ended=\"onStopAudio()\"></audio>\n\t\t<el-divider content-position=\"center\"></el-divider>\n\t\t<el-row class=\"chat-voice-btn-group\">\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='STOP'\" @click=\"onStartRecord()\">开始录音</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='RUNNING'\" @click=\"onPauseRecord()\">暂停录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='PAUSE'\" @click=\"onResumeRecord()\">继续录音</el-button>\n\t\t\t<el-button round type=\"danger\" v-show=\"state=='RUNNING'||state=='PAUSE'\" @click=\"onCompleteRecord()\">\n\t\t\t\t结束录音</el-button>\n\t\t\t<el-button round type=\"success\" v-show=\"state=='COMPLETE' && mode!='PLAY'\" @click=\"onPlayAudio()\">播放录音\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='COMPLETE' && mode=='PLAY'\" @click=\"onStopAudio()\">停止播放\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onRestartRecord()\">重新录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onSendRecord()\">立即发送</el-button>\n\t\t</el-row>\n\t</el-dialog>\n\n</template>\n\n<script>\n\timport Recorder from 'js-audio-recorder';\n\n\texport default {\n\t\tname: 'chatVoice',\n\t\tprops: {\n\t\t\tvisible: {\n\t\t\t\ttype: Boolean\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\trc: new Recorder(),\n\t\t\t\taudio: new Audio(),\n\t\t\t\tstate: 'STOP', // STOP、RUNNING、PAUSE、COMPLETE\n\t\t\t\tstateTip: \"未开始\",\n\t\t\t\tmode: 'RECORD', // RECORD 、PLAY\n\t\t\t\tduration: 0,\n\t\t\t\turl: \"\"\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonClose() {\n\t\t\t\t// 关闭前清除数据\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder();\n\t\t\t\tthis.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.state = 'STOP';\n\t\t\t\tthis.stateTip = '未开始';\n\t\t\t\tthis.$emit(\"close\");\n\t\t\t},\n\t\t\tonStartRecord() {\n\t\t\t\tthis.rc.start().then((stream) => {\n\t\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tthis.$message.error(error);\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tonPauseRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'PAUSE';\n\t\t\t\tthis.stateTip = \"已暂停录音\";\n\t\t\t},\n\t\t\tonResumeRecord() {\n\t\t\t\tthis.rc.resume();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonCompleteRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'COMPLETE';\n\t\t\t\tthis.stateTip = \"已结束录音\";\n\t\t\t},\n\t\t\tonPlayAudio() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet url = URL.createObjectURL(wav);\n\t\t\t\tthis.$refs.audio.src = url;\n\t\t\t\tthis.$refs.audio.play();\n\t\t\t\tthis.mode = 'PLAY';\n\t\t\t},\n\t\t\tonStopAudio() {\n\t\t\t\tconsole.log(this.$refs.audio);\n\t\t\t\tthis.$refs.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t},\n\t\t\tonRestartRecord() {\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder()\n\t\t\t\tthis.rc.start();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonSendRecord() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet name = new Date().getDate() + '.wav';\n\t\t\t\tvar formData = new window.FormData()\n\t\t\t\tformData.append('file', wav, name);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: '/file/upload',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((url) => {\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tduration: parseInt(this.rc.duration),\n\t\t\t\t\t\turl: url\n\t\t\t\t\t}\n\t\t\t\t\tthis.$emit(\"send\", data);\n\t\t\t\t\tthis.onClose();\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.chat-voice {\n\n\t\t.chat-voice-tip {\n\t\t\tfont-size: 18px;\n\t\t}\n\n\t\t.chat-voice-btn-group {\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t}\n</style>\n"]}]}