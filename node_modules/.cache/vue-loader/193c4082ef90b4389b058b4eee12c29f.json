{"remainingRequest":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\im-ui\\src\\components\\chat\\ChatVoice.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\im-ui\\src\\components\\chat\\ChatVoice.vue","mtime":1703809564000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1710142166000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CglpbXBvcnQgUmVjb3JkZXIgZnJvbSAnanMtYXVkaW8tcmVjb3JkZXInOwoKCWV4cG9ydCBkZWZhdWx0IHsKCQluYW1lOiAnY2hhdFZvaWNlJywKCQlwcm9wczogewoJCQl2aXNpYmxlOiB7CgkJCQl0eXBlOiBCb29sZWFuCgkJCX0KCQl9LAoJCWRhdGEoKSB7CgkJCXJldHVybiB7CgkJCQlyYzogbmV3IFJlY29yZGVyKCksCgkJCQlhdWRpbzogbmV3IEF1ZGlvKCksCgkJCQlzdGF0ZTogJ1NUT1AnLCAvLyBTVE9Q44CBUlVOTklOR+OAgVBBVVNF44CBQ09NUExFVEUKCQkJCXN0YXRlVGlwOiAi5pyq5byA5aeLIiwKCQkJCW1vZGU6ICdSRUNPUkQnLCAvLyBSRUNPUkQg44CBUExBWQoJCQkJZHVyYXRpb246IDAsCgkJCQl1cmw6ICIiCgkJCX0KCQl9LAoJCW1ldGhvZHM6IHsKCQkJb25DbG9zZSgpIHsKCQkJCS8vIOWFs+mXreWJjea4hemZpOaVsOaNrgoJCQkJdGhpcy5yYy5kZXN0cm95KCk7CgkJCQl0aGlzLnJjID0gbmV3IFJlY29yZGVyKCk7CgkJCQl0aGlzLmF1ZGlvLnBhdXNlKCk7CgkJCQl0aGlzLm1vZGUgPSAnUkVDT1JEJzsKCQkJCXRoaXMuc3RhdGUgPSAnU1RPUCc7CgkJCQl0aGlzLnN0YXRlVGlwID0gJ+acquW8gOWniyc7CgkJCQl0aGlzLiRlbWl0KCJjbG9zZSIpOwoJCQl9LAoJCQlvblN0YXJ0UmVjb3JkKCkgewoJCQkJdGhpcy5yYy5zdGFydCgpLnRoZW4oKHN0cmVhbSkgPT4gewoJCQkJCXRoaXMuc3RhdGUgPSAnUlVOTklORyc7CgkJCQkJdGhpcy5zdGF0ZVRpcCA9ICLmraPlnKjlvZXpn7MuLi4iOwoJCQkJfSkuY2F0Y2goZXJyb3IgPT4gewoJCQkJCWNvbnNvbGUubG9nKGVycm9yKTsKCQkJCQl0aGlzLiRtZXNzYWdlLmVycm9yKGVycm9yKTsKCQkJCQljb25zb2xlLmxvZyhlcnJvcik7CgkJCQl9KTsKCgoJCQl9LAoJCQlvblBhdXNlUmVjb3JkKCkgewoJCQkJdGhpcy5yYy5wYXVzZSgpOwoJCQkJdGhpcy5zdGF0ZSA9ICdQQVVTRSc7CgkJCQl0aGlzLnN0YXRlVGlwID0gIuW3suaaguWBnOW9lemfsyI7CgkJCX0sCgkJCW9uUmVzdW1lUmVjb3JkKCkgewoJCQkJdGhpcy5yYy5yZXN1bWUoKTsKCQkJCXRoaXMuc3RhdGUgPSAnUlVOTklORyc7CgkJCQl0aGlzLnN0YXRlVGlwID0gIuato+WcqOW9lemfsy4uLiI7CgkJCX0sCgkJCW9uQ29tcGxldGVSZWNvcmQoKSB7CgkJCQl0aGlzLnJjLnBhdXNlKCk7CgkJCQl0aGlzLnN0YXRlID0gJ0NPTVBMRVRFJzsKCQkJCXRoaXMuc3RhdGVUaXAgPSAi5bey57uT5p2f5b2V6Z+zIjsKCQkJfSwKCQkJb25QbGF5QXVkaW8oKSB7CgkJCQlsZXQgd2F2ID0gdGhpcy5yYy5nZXRXQVZCbG9iKCk7CgkJCQlsZXQgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTCh3YXYpOwoJCQkJdGhpcy4kcmVmcy5hdWRpby5zcmMgPSB1cmw7CgkJCQl0aGlzLiRyZWZzLmF1ZGlvLnBsYXkoKTsKCQkJCXRoaXMubW9kZSA9ICdQTEFZJzsKCQkJfSwKCQkJb25TdG9wQXVkaW8oKSB7CgkJCQljb25zb2xlLmxvZyh0aGlzLiRyZWZzLmF1ZGlvKTsKCQkJCXRoaXMuJHJlZnMuYXVkaW8ucGF1c2UoKTsKCQkJCXRoaXMubW9kZSA9ICdSRUNPUkQnOwoJCQl9LAoJCQlvblJlc3RhcnRSZWNvcmQoKSB7CgkJCQl0aGlzLnJjLmRlc3Ryb3koKTsKCQkJCXRoaXMucmMgPSBuZXcgUmVjb3JkZXIoKQoJCQkJdGhpcy5yYy5zdGFydCgpOwoJCQkJdGhpcy5zdGF0ZSA9ICdSVU5OSU5HJzsKCQkJCXRoaXMubW9kZSA9ICdSRUNPUkQnOwoJCQkJdGhpcy5zdGF0ZVRpcCA9ICLmraPlnKjlvZXpn7MuLi4iOwoJCQl9LAoJCQlvblNlbmRSZWNvcmQoKSB7CgkJCQlsZXQgd2F2ID0gdGhpcy5yYy5nZXRXQVZCbG9iKCk7CgkJCQlsZXQgbmFtZSA9IG5ldyBEYXRlKCkuZ2V0RGF0ZSgpICsgJy53YXYnOwoJCQkJdmFyIGZvcm1EYXRhID0gbmV3IHdpbmRvdy5Gb3JtRGF0YSgpCgkJCQlmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB3YXYsIG5hbWUpOwoJCQkJdGhpcy4kaHR0cCh7CgkJCQkJdXJsOiAnL2ZpbGUvdXBsb2FkJywKCQkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCQltZXRob2Q6ICdwb3N0JywKCQkJCQloZWFkZXJzOiB7CgkJCQkJCSdDb250ZW50LVR5cGUnOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScKCQkJCQl9CgkJCQl9KS50aGVuKCh1cmwpID0+IHsKCQkJCQlsZXQgZGF0YSA9IHsKCQkJCQkJZHVyYXRpb246IHBhcnNlSW50KHRoaXMucmMuZHVyYXRpb24pLAoJCQkJCQl1cmw6IHVybAoJCQkJCX0KCQkJCQl0aGlzLiRlbWl0KCJzZW5kIiwgZGF0YSk7CgkJCQkJdGhpcy5vbkNsb3NlKCk7CgkJCQl9KQoJCQl9CgkJfQoKCX0K"},{"version":3,"sources":["ChatVoice.vue"],"names":[],"mappings":";AA0BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"ChatVoice.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n\t<el-dialog class=\"chat-voice\" title=\"语音录制\" :visible.sync=\"visible\" width=\"600px\" :before-close=\"onClose\">\n\t\t<div v-show=\"mode=='RECORD'\">\n\t\t\t<div class=\"chat-voice-tip\">{{stateTip}}</div>\n\t\t\t<div>时长: {{state=='STOP'?0:parseInt(rc.duration)}}s</div>\n\t\t</div>\n\t\t<audio v-show=\"mode=='PLAY'\" :src=\"url\" controls ref=\"audio\" @ended=\"onStopAudio()\"></audio>\n\t\t<el-divider content-position=\"center\"></el-divider>\n\t\t<el-row class=\"chat-voice-btn-group\">\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='STOP'\" @click=\"onStartRecord()\">开始录音</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='RUNNING'\" @click=\"onPauseRecord()\">暂停录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='PAUSE'\" @click=\"onResumeRecord()\">继续录音</el-button>\n\t\t\t<el-button round type=\"danger\" v-show=\"state=='RUNNING'||state=='PAUSE'\" @click=\"onCompleteRecord()\">\n\t\t\t\t结束录音</el-button>\n\t\t\t<el-button round type=\"success\" v-show=\"state=='COMPLETE' && mode!='PLAY'\" @click=\"onPlayAudio()\">播放录音\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='COMPLETE' && mode=='PLAY'\" @click=\"onStopAudio()\">停止播放\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onRestartRecord()\">重新录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onSendRecord()\">立即发送</el-button>\n\t\t</el-row>\n\t</el-dialog>\n\n</template>\n\n<script>\n\timport Recorder from 'js-audio-recorder';\n\n\texport default {\n\t\tname: 'chatVoice',\n\t\tprops: {\n\t\t\tvisible: {\n\t\t\t\ttype: Boolean\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\trc: new Recorder(),\n\t\t\t\taudio: new Audio(),\n\t\t\t\tstate: 'STOP', // STOP、RUNNING、PAUSE、COMPLETE\n\t\t\t\tstateTip: \"未开始\",\n\t\t\t\tmode: 'RECORD', // RECORD 、PLAY\n\t\t\t\tduration: 0,\n\t\t\t\turl: \"\"\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonClose() {\n\t\t\t\t// 关闭前清除数据\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder();\n\t\t\t\tthis.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.state = 'STOP';\n\t\t\t\tthis.stateTip = '未开始';\n\t\t\t\tthis.$emit(\"close\");\n\t\t\t},\n\t\t\tonStartRecord() {\n\t\t\t\tthis.rc.start().then((stream) => {\n\t\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tthis.$message.error(error);\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tonPauseRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'PAUSE';\n\t\t\t\tthis.stateTip = \"已暂停录音\";\n\t\t\t},\n\t\t\tonResumeRecord() {\n\t\t\t\tthis.rc.resume();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonCompleteRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'COMPLETE';\n\t\t\t\tthis.stateTip = \"已结束录音\";\n\t\t\t},\n\t\t\tonPlayAudio() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet url = URL.createObjectURL(wav);\n\t\t\t\tthis.$refs.audio.src = url;\n\t\t\t\tthis.$refs.audio.play();\n\t\t\t\tthis.mode = 'PLAY';\n\t\t\t},\n\t\t\tonStopAudio() {\n\t\t\t\tconsole.log(this.$refs.audio);\n\t\t\t\tthis.$refs.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t},\n\t\t\tonRestartRecord() {\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder()\n\t\t\t\tthis.rc.start();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonSendRecord() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet name = new Date().getDate() + '.wav';\n\t\t\t\tvar formData = new window.FormData()\n\t\t\t\tformData.append('file', wav, name);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: '/file/upload',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((url) => {\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tduration: parseInt(this.rc.duration),\n\t\t\t\t\t\turl: url\n\t\t\t\t\t}\n\t\t\t\t\tthis.$emit(\"send\", data);\n\t\t\t\t\tthis.onClose();\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.chat-voice {\n\n\t\t.chat-voice-tip {\n\t\t\tfont-size: 18px;\n\t\t}\n\n\t\t.chat-voice-btn-group {\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t}\n</style>\n"]}]}