{"remainingRequest":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\im-ui\\src\\components\\common\\FileUpload.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\im-ui\\src\\components\\common\\FileUpload.vue","mtime":1703809564000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1710142166000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CglleHBvcnQgZGVmYXVsdCB7CgkJbmFtZTogImZpbGVVcGxvYWQiLAoJCWRhdGEoKSB7CgkJCXJldHVybiB7CgkJCQlsb2FkaW5nOiBudWxsLAoJCQkJdXBsb2FkSGVhZGVyczogewoJCQkJCSJhY2Nlc3NUb2tlbiI6IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc1Rva2VuJykKCQkJCX0KCQkJfQoJCX0sCgkJcHJvcHM6IHsKCQkJYWN0aW9uOiB7CgkJCQl0eXBlOiBTdHJpbmcsCgkJCQlyZXF1aXJlZDogZmFsc2UKCQkJfSwKCQkJZmlsZVR5cGVzOiB7CgkJCQl0eXBlOiBBcnJheSwKCQkJCWRlZmF1bHQ6IG51bGwKCQkJfSwKCQkJbWF4U2l6ZTogewoJCQkJdHlwZTogTnVtYmVyLAoJCQkJZGVmYXVsdDogbnVsbAoJCQl9LAoJCQlzaG93TG9hZGluZzogewoJCQkJdHlwZTogQm9vbGVhbiwKCQkJCWRlZmF1bHQ6IGZhbHNlCgkJCX0sCgkJCWRpc2FibGVkOiB7CgkJCQl0eXBlOiBCb29sZWFuLAoJCQkJZGVmYXVsdDogZmFsc2UKCQkJfQoJCX0sCgkJbWV0aG9kczogewoJCQlvbkZpbGVVcGxvYWQoZmlsZSkgewoJCQkJLy8g5bGV56S65Yqg6L295p2hCgkJCQlpZiAodGhpcy5zaG93TG9hZGluZykgewoJCQkJCXRoaXMubG9hZGluZyA9IHRoaXMuJGxvYWRpbmcoewoJCQkJCQlsb2NrOiB0cnVlLAoJCQkJCQl0ZXh0OiAn5q2j5Zyo5LiK5LygLi4uJywKCQkJCQkJc3Bpbm5lcjogJ2VsLWljb24tbG9hZGluZycsCgkJCQkJCWJhY2tncm91bmQ6ICdyZ2JhKDAsIDAsIDAsIDAuNyknCgkJCQkJfSk7CgkJCQl9CgoJCQkJbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCkKCQkJCWZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUuZmlsZSkKCQkJCXRoaXMuJGh0dHAoewoJCQkJCXVybDogdGhpcy5hY3Rpb24sCgkJCQkJZGF0YTogZm9ybURhdGEsCgkJCQkJbWV0aG9kOiAncG9zdCcsCgkJCQkJaGVhZGVyczogewoJCQkJCQknQ29udGVudC1UeXBlJzogJ211bHRpcGFydC9mb3JtLWRhdGEnCgkJCQkJfQoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCXRoaXMuJGVtaXQoInN1Y2Nlc3MiLCBkYXRhLCBmaWxlLmZpbGUpOwoJCQkJfSkuY2F0Y2goKGUpID0+IHsKCQkJCQl0aGlzLiRlbWl0KCJmYWlsIiwgZSwgZmlsZS5maWxlKTsKCQkJCX0pLmZpbmFsbHkoKCkgPT4gewoJCQkJCXRoaXMubG9hZGluZyAmJiB0aGlzLmxvYWRpbmcuY2xvc2UoKTsKCQkJCX0pCgkJCX0sCgkJCWJlZm9yZVVwbG9hZChmaWxlKSB7CgkJCQkvLyDmoKHpqozmlofku7bnsbvlnosKCQkJCWlmICh0aGlzLmZpbGVUeXBlcyAmJiB0aGlzLmZpbGVUeXBlcy5sZW5ndGggPiAwKSB7CgkJCQkJbGV0IGZpbGVUeXBlID0gZmlsZS50eXBlOwoJCQkJCWxldCB0ID0gdGhpcy5maWxlVHlwZXMuZmluZCgodCkgPT4gdC50b0xvd2VyQ2FzZSgpID09PSBmaWxlVHlwZSk7CgkJCQkJaWYgKHQgPT09IHVuZGVmaW5lZCkgewoJCQkJCQl0aGlzLiRtZXNzYWdlLmVycm9yKGDmlofku7bmoLzlvI/plJnor6/vvIzor7fkuIrkvKDku6XkuIvmoLzlvI/nmoTmlofku7bvvJoke3RoaXMuZmlsZVR5cGVzLmpvaW4oIuOAgSIpfWApOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkJLy8g5qCh6aqM5aSn5bCPCgkJCQlpZiAodGhpcy5tYXhTaXplICYmIGZpbGUuc2l6ZSA+IHRoaXMubWF4U2l6ZSkgewoJCQkJCXRoaXMuJG1lc3NhZ2UuZXJyb3IoYOaWh+S7tuWkp+Wwj+S4jeiDvei2hei/hyAke3RoaXMuZmlsZVNpemVTdHJ9IWApOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCgkJCQl0aGlzLiRlbWl0KCJiZWZvcmUiLCBmaWxlKTsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfSwKCQljb21wdXRlZDogewoJCQlmaWxlU2l6ZVN0cigpIHsKCQkJCWlmICh0aGlzLm1heFNpemUgPiAxMDI0ICogMTAyNCkgewoJCQkJCXJldHVybiBNYXRoLnJvdW5kKHRoaXMubWF4U2l6ZSAvIDEwMjQgLyAxMDI0KSArICJNIjsKCQkJCX0KCQkJCWlmICh0aGlzLm1heFNpemUgPiAxMDI0KSB7CgkJCQkJcmV0dXJuIE1hdGgucm91bmQodGhpcy5tYXhTaXplIC8gMTAyNCkgKyAiS0IiOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXMubWF4U2l6ZSArICJCIjsKCQkJfQoJCX0KCX0K"},{"version":3,"sources":["FileUpload.vue"],"names":[],"mappings":";AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FileUpload.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\n\t<el-upload :action=\"'#'\" :http-request=\"onFileUpload\" :accept=\"fileTypes==null?'':fileTypes.join(',')\" :show-file-list=\"false\"\n\t\t:disabled=\"disabled\" :before-upload=\"beforeUpload\">\n\t\t<slot></slot>\n\t</el-upload>\n</template>\n\n<script>\n\texport default {\n\t\tname: \"fileUpload\",\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tloading: null,\n\t\t\t\tuploadHeaders: {\n\t\t\t\t\t\"accessToken\": sessionStorage.getItem('accessToken')\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tprops: {\n\t\t\taction: {\n\t\t\t\ttype: String,\n\t\t\t\trequired: false\n\t\t\t},\n\t\t\tfileTypes: {\n\t\t\t\ttype: Array,\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t\tmaxSize: {\n\t\t\t\ttype: Number,\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t\tshowLoading: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonFileUpload(file) {\n\t\t\t\t// 展示加载条\n\t\t\t\tif (this.showLoading) {\n\t\t\t\t\tthis.loading = this.$loading({\n\t\t\t\t\t\tlock: true,\n\t\t\t\t\t\ttext: '正在上传...',\n\t\t\t\t\t\tspinner: 'el-icon-loading',\n\t\t\t\t\t\tbackground: 'rgba(0, 0, 0, 0.7)'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlet formData = new FormData()\n\t\t\t\tformData.append('file', file.file)\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: this.action,\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((data) => {\n\t\t\t\t\tthis.$emit(\"success\", data, file.file);\n\t\t\t\t}).catch((e) => {\n\t\t\t\t\tthis.$emit(\"fail\", e, file.file);\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tthis.loading && this.loading.close();\n\t\t\t\t})\n\t\t\t},\n\t\t\tbeforeUpload(file) {\n\t\t\t\t// 校验文件类型\n\t\t\t\tif (this.fileTypes && this.fileTypes.length > 0) {\n\t\t\t\t\tlet fileType = file.type;\n\t\t\t\t\tlet t = this.fileTypes.find((t) => t.toLowerCase() === fileType);\n\t\t\t\t\tif (t === undefined) {\n\t\t\t\t\t\tthis.$message.error(`文件格式错误，请上传以下格式的文件：${this.fileTypes.join(\"、\")}`);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// 校验大小\n\t\t\t\tif (this.maxSize && file.size > this.maxSize) {\n\t\t\t\t\tthis.$message.error(`文件大小不能超过 ${this.fileSizeStr}!`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.$emit(\"before\", file);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tfileSizeStr() {\n\t\t\t\tif (this.maxSize > 1024 * 1024) {\n\t\t\t\t\treturn Math.round(this.maxSize / 1024 / 1024) + \"M\";\n\t\t\t\t}\n\t\t\t\tif (this.maxSize > 1024) {\n\t\t\t\t\treturn Math.round(this.maxSize / 1024) + \"KB\";\n\t\t\t\t}\n\t\t\t\treturn this.maxSize + \"B\";\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n</style>"]}]}