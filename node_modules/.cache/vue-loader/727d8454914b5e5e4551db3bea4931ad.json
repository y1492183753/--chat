{"remainingRequest":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\im-ui\\src\\components\\chat\\ChatBox.vue?vue&type=style&index=0&id=35ac558c&lang=scss","dependencies":[{"path":"D:\\im-ui\\src\\components\\chat\\ChatBox.vue","mtime":1711256613938},{"path":"D:\\im-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1710142168000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1710142168000},{"path":"D:\\im-ui\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1710142170000},{"path":"D:\\im-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1710142168000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5oZWFkZXJ7Cgljb2xvcjogcmdiKDE1MiwgMTUyLCAxNTIpOwoJbGV0dGVyLXNwYWNpbmc6IDFweDsKCgpiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgcmdiKDI1MywgMjUwLCAyNTApLCAjZTJlOWY3KTsKfQoJLmNoYXQtYm94IHsKCQlmb250LWZhbWlseTogQ2FsaWJyaSwgc2Fucy1zZXJpZjsKCQlwb3NpdGlvbjogcmVsYXRpdmU7CgkJd2lkdGg6IDEwMCU7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKCIuLi8uLi9hc3NldHMvaW1hZ2Uv6L6T5YWl5qGG6IOM5pmvLmpwZyIpOwoJCWJhY2tncm91bmQtc2l6ZTogY292ZXI7CgkJYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoKCQkuZWwtaGVhZGVyIHsKCQkJcGFkZGluZzogNXB4OwoJCQliYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKCQkJbGluZS1oZWlnaHQ6IDUwcHg7CgkJCWZvbnQtc2l6ZTogMjBweDsKCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJLy8gYm9yZGVyOiAjZGRkZGRkIHNvbGlkIDFweDsKCQkJLy8gYm94LXNoYWRvdzogM3B4IDFweCAzcHggIzIyMjIyMmIwOwoKCQkJLmJ0bi1zaWRlIHsKCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCXJpZ2h0OiAyMHB4OwoJCQkJbGluZS1oZWlnaHQ6IDYwcHg7CgkJCQlmb250LXNpemU6IDIycHg7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgoJCQkJJjpob3ZlciB7CgkJCQkJZm9udC1zaXplOiAzMHB4OwoJCQkJfQoJCQl9CgkJfQoJCQoJCS5pbS1jaGF0LW1haW4gewoJCQlwYWRkaW5nOiAwOwoJCQkvLyBib3JkZXI6ICNkZGRkZGQgc29saWQgMXB4OwoKCQkJLmltLWNoYXQtYm94IHsKCQkJCT51bCB7CgkJCQkJcGFkZGluZzogMCAyMHB4OwoKCQkJCQlsaSB7CgkJCQkJCWxpc3Qtc3R5bGUtdHlwZTogbm9uZTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCS5pbS1jaGF0LWZvb3RlciB7CgkJCWRpc3BsYXk6IGZsZXg7CgkJCWZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CgkJCXBhZGRpbmc6IDA7CgkJCS8vIGJvcmRlcjogI2RkZGRkZCBzb2xpZCAxcHg7CgoJCQkuY2hhdC10b29sLWJhciB7CgoJCQkJZGlzcGxheTogZmxleDsKCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQkJCXdpZHRoOiAxMDAlOwoJCQkJaGVpZ2h0OiA1MHB4OwoJCQkJdGV4dC1hbGlnbjogbGVmdDsKCQkJCWJveC1zaXppbmc6IGJvcmRlci1ib3g7CgkJCQlib3JkZXItdG9wOiAxcHggc29saWQgI2RkZDsKCQkJCXBhZGRpbmc6IDVweDsKCgkJCQk+ZGl2IHsKCQkJCQltYXJnaW4tbGVmdDogMjBweDsKCQkJCQlmb250LXNpemU6IDM1cHg7CgkJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQkJCWNvbG9yOiAjOGI4YjhiOwoJCQkJCWxpbmUtaGVpZ2h0OiA0MHB4OwoKCQkJCQkmOmhvdmVyIHsKCQkJCQkJY29sb3I6IGJsYWNrOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLnNlbmQtY29udGVudC1hcmVhIHsKCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlmbGV4LWRpcmVjdGlvbjogY29sdW1uOwoJCQkJaGVpZ2h0OiAxMDAlOwoJCQkJYmFja2dyb3VuZC1jb2xvcjogd2hpdGUgIWltcG9ydGFudDsKCgoJCQkJLnNlbmQtdGV4dC1hcmVhIHsKCQkJCQlib3gtc2l6aW5nOiBib3JkZXItYm94OwoJCQkJCXBhZGRpbmc6IDVweDsKCQkJCQl3aWR0aDogMTAwJTsKCQkJCQlmbGV4OiAxOwoJCQkJCXJlc2l6ZTogbm9uZTsKCQkJCQlmb250LXNpemU6IDE2cHg7CgkJCQkJY29sb3I6IGJsYWNrOwoJCQkJCW91dGxpbmUtY29sb3I6IHJnYmEoMjE5LCAyMzUsIDI0OSwgMC42MSk7CgoJCQkJCXRleHQtYWxpZ246IGxlZnQ7CgkJCQkJbGluZS1oZWlnaHQ6IDMwIHB4OwoKCQkJCQkuYXQgewoJCQkJCQljb2xvcjogYmx1ZTsKCQkJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJCQl9CgoJCQkJCS5lbW8gewoJCQkJCQl3aWR0aDogMzBweDsKCQkJCQkJaGVpZ2h0OiAzMHB4OwoJCQkJCQl2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOwoJCQkJCX0KCQkJCX0KCgkJCQkuc2VuZC1pbWFnZS1hcmVhIHsKCQkJCQl0ZXh0LWFsaWduOiBsZWZ0OwoJCQkJCWJvcmRlcjogIzUzYTBlNyBzb2xpZCAxcHg7CgoJCQkJCS5zZW5kLWltYWdlLWJveCB7CgkJCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQkJCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoKCQkJCQkJLnNlbmQtaW1hZ2UgewoJCQkJCQkJbWF4LWhlaWdodDogMTgwcHg7CgkJCQkJCQlib3JkZXI6IDFweCBzb2xpZCAjY2NjOwoJCQkJCQkJYm9yZGVyLXJhZGl1czogMiU7CgkJCQkJCQltYXJnaW46IDJweDsKCQkJCQkJfQoKCQkJCQkJLnNlbmQtaW1hZ2UtY2xvc2UgewoJCQkJCQkJcG9zaXRpb246IGFic29sdXRlOwoJCQkJCQkJcGFkZGluZzogM3B4OwoJCQkJCQkJcmlnaHQ6IDdweDsKCQkJCQkJCXRvcDogN3B4OwoJCQkJCQkJY29sb3I6IHdoaXRlOwoJCQkJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQkJCQkJZm9udC1zaXplOiAxNXB4OwoJCQkJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJCQkJCWJhY2tncm91bmQtY29sb3I6ICNhYWE7CgkJCQkJCQlib3JkZXItcmFkaXVzOiA1MCU7CgkJCQkJCQlib3JkZXI6IDFweCBzb2xpZCAjY2NjOwoJCQkJCQl9CgkJCQkJfQoKCQkJCX0KCgkJCQkuc2VuZC1idG4tYXJlYSB7CgkJCQkJcGFkZGluZzogMTBweDsKCQkJCQlwb3NpdGlvbjogYWJzb2x1dGU7CgkJCQkJYm90dG9tOiAwOwoJCQkJCXJpZ2h0OiAwOwoJCQkJfQoJCQl9CgoJCX0KCgkJLmNoYXQtZ3JvdXAtc2lkZS1ib3ggewoJCQlib3JkZXI6ICNkZGRkZGQgc29saWQgMXB4OwoJCQlhbmltYXRpb246IHJ0bC1kcmF3ZXItaW4gLjNzIDFtczsKCQl9Cgl9Cg=="},{"version":3,"sources":["ChatBox.vue"],"names":[],"mappings":";AA+rBA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA","file":"ChatBox.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n\t<div class=\"chat-box\" @click=\"closeRefBox()\" @mousemove=\"readedMessage()\">\n\t\t<el-container>\n\t\t\t<el-header height=\"60px\" class=\"header\">\n\t\t\t\t<span>{{title}}</span>\n\t\t\t\t<span title=\"群聊信息\" v-show=\"this.chat.type=='GROUP'\" class=\"btn-side el-icon-more\"\n\t\t\t\t\t@click=\"showSide=!showSide\"></span>\n\t\t\t</el-header>\n\t\t\t<el-main style=\"padding: 0;\">\n\t\t\t\t<el-container>\n\t\t\t\t\t<el-container class=\"content-box\">\n\t\t\t\t\t\t<el-main class=\"im-chat-main\" id=\"chatScrollBox\" @scroll=\"onScroll\">\n\t\t\t\t\t\t\t<div class=\"im-chat-box\">\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t<li v-for=\"(msgInfo,idx) in chat.messages\" :key=\"idx\">\n\t\t\t\t\t\t\t\t\t\t<chat-message-item v-show=\"idx>=showMinIdx\" :mine=\"msgInfo.sendId == mine.id\"\n\t\t\t\t\t\t\t\t\t\t\t:headImage=\"headImage(msgInfo)\" :showName=\"showName(msgInfo)\"\n\t\t\t\t\t\t\t\t\t\t\t:msgInfo=\"msgInfo\" @delete=\"deleteMessage\" @recall=\"recallMessage\">\n\t\t\t\t\t\t\t\t\t\t</chat-message-item>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</el-main>\n\t\t\t\t\t\t<el-footer height=\"240px\" class=\"im-chat-footer\">\n\t\t\t\t\t\t\t<div class=\"chat-tool-bar\">\n\t\t\t\t\t\t\t\t<div title=\"表情\" class=\"icon iconfont icon-biaoqing\" ref=\"emotion\"\n\t\t\t\t\t\t\t\t\t@click.stop=\"showEmotionBox()\">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div title=\"发送图片\">\n\t\t\t\t\t\t\t\t\t<file-upload :action=\"'/image/upload'\" :maxSize=\"5*1024*1024\"\n\t\t\t\t\t\t\t\t\t\t:fileTypes=\"['image/jpeg', 'image/png', 'image/jpg', 'image/webp','image/gif']\"\n\t\t\t\t\t\t\t\t\t\t@before=\"onImageBefore\" @success=\"onImageSuccess\" @fail=\"onImageFail\">\n\t\t\t\t\t\t\t\t\t\t<i class=\"el-icon-picture-outline\"></i>\n\t\t\t\t\t\t\t\t\t</file-upload>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div title=\"发送文件\">\n\t\t\t\t\t\t\t\t\t<file-upload :action=\"'/file/upload'\" :maxSize=\"10*1024*1024\" @before=\"onFileBefore\"\n\t\t\t\t\t\t\t\t\t\t@success=\"onFileSuccess\" @fail=\"onFileFail\">\n\t\t\t\t\t\t\t\t\t\t<i class=\"el-icon-wallet\"></i>\n\t\t\t\t\t\t\t\t\t</file-upload>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div title=\"发送语音\" class=\"el-icon-microphone\" @click=\"showVoiceBox()\">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div title=\"视频聊天\" v-show=\"chat.type=='PRIVATE'\" class=\"el-icon-phone-outline\"\n\t\t\t\t\t\t\t\t\t@click=\"showVideoBox()\">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div title=\"聊天记录\" class=\"el-icon-chat-dot-round\" @click=\"showHistoryBox()\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"send-content-area\">\n\t\t\t\t\t\t\t\t<div contenteditable=\"true\" v-show=\"!sendImageUrl\" ref=\"editBox\" class=\"send-text-area\"\n\t\t\t\t\t\t\t\t\t:disabled=\"lockMessage\" @paste.prevent=\"onEditorPaste\"\n\t\t\t\t\t\t\t\t\t@compositionstart=\"onEditorCompositionStart\"\n\t\t\t\t\t\t\t\t\t@compositionend=\"onEditorCompositionEnd\" @input=\"onEditorInput\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"温馨提示:可以粘贴截图到这里了哦~\" @blur=\"onEditBoxBlur()\" @keydown.down=\"onKeyDown\"\n\t\t\t\t\t\t\t\t\t@keydown.up=\"onKeyUp\" @keydown.enter.prevent=\"onKeyEnter\">\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div v-show=\"sendImageUrl\" class=\"send-image-area\">\n\t\t\t\t\t\t\t\t\t<div class=\"send-image-box\">\n\t\t\t\t\t\t\t\t\t\t<img class=\"send-image\" :src=\"sendImageUrl\" />\n\t\t\t\t\t\t\t\t\t\t<span class=\"send-image-close el-icon-close\" title=\"删除\"\n\t\t\t\t\t\t\t\t\t\t\t@click=\"removeSendImage()\"></span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"send-btn-area\">\n\t\t\t\t\t\t\t\t\t<el-button type=\"primary\" style=\"background-color:569CD6\" size=\"large\" @click=\"sendMessage()\">发送</el-button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</el-footer>\n\t\t\t\t\t</el-container>\n\t\t\t\t\t<el-aside class=\"chat-group-side-box\" width=\"300px\" v-show=\"showSide\">\n\t\t\t\t\t\t<chat-group-side :group=\"group\" :groupMembers=\"groupMembers\" @reload=\"loadGroup(group.id)\">\n\t\t\t\t\t\t</chat-group-side>\n\t\t\t\t\t</el-aside>\n\t\t\t\t</el-container>\n\t\t\t</el-main>\n\t\t\t<emotion ref=\"emoBox\" @emotion=\"onEmotion\"></Emotion>\n\t\t\t<chat-at-box ref=\"atBox\" :ownerId=\"group.ownerId\" :members=\"groupMembers\" :search-text=\"atSearchText\"\n\t\t\t\t@select=\"onAtSelect\"></chat-at-box>\n\t\t\t<chat-voice :visible=\"showVoice\" @close=\"closeVoiceBox\" @send=\"onSendVoice\"></chat-voice>\n\t\t\t<chat-history :visible=\"showHistory\" :chat=\"chat\" :friend=\"friend\" :group=\"group\"\n\t\t\t\t:groupMembers=\"groupMembers\" @close=\"closeHistoryBox\"></chat-history>\n\t\t</el-container>\n\t</div>\n</template>\n\n<script>\n\timport ChatGroupSide from \"./ChatGroupSide.vue\";\n\timport ChatMessageItem from \"./ChatMessageItem.vue\";\n\timport FileUpload from \"../common/FileUpload.vue\";\n\timport Emotion from \"../common/Emotion.vue\";\n\timport ChatVoice from \"./ChatVoice.vue\";\n\timport ChatHistory from \"./ChatHistory.vue\";\n\timport ChatAtBox from \"./ChatAtBox.vue\"\n\n\texport default {\n\t\tname: \"chatPrivate\",\n\t\tcomponents: {\n\t\t\tChatMessageItem,\n\t\t\tFileUpload,\n\t\t\tChatGroupSide,\n\t\t\tEmotion,\n\t\t\tChatVoice,\n\t\t\tChatHistory,\n\t\t\tChatAtBox\n\t\t},\n\t\tprops: {\n\t\t\tchat: {\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tfriend: {},\n\t\t\t\tgroup: {},\n\t\t\t\tgroupMembers: [],\n\t\t\t\tsendImageUrl: \"\",\n\t\t\t\tsendImageFile: \"\",\n\t\t\t\tshowVoice: false, // 是否显示语音录制弹窗\n\t\t\t\tshowSide: false, // 是否显示群聊信息栏\n\t\t\t\tshowHistory: false, // 是否显示历史聊天记录\n\t\t\t\tlockMessage: false, // 是否锁定发送，\n\t\t\t\tshowMinIdx: 0, // 下标低于showMinIdx的消息不显示，否则页面会很卡\n\t\t\t\tatSearchText: \"\",\n\t\t\t\tfocusNode: null, // 缓存光标所在节点\n\t\t\t\tfocusOffset: null, // 缓存光标所在节点位置\n\t\t\t\tzhLock: false // 解决中文输入法触发英文的情况\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tcloseRefBox() {\n\t\t\t\tthis.$refs.emoBox.close();\n\t\t\t\tthis.$refs.atBox.close();\n\t\t\t},\n\t\t\tonKeyDown() {\n\t\t\t\tif (this.$refs.atBox.show) {\n\t\t\t\t\tthis.$refs.atBox.moveDown()\n\t\t\t\t}\n\t\t\t},\n\t\t\tonKeyUp() {\n\t\t\t\tif (this.$refs.atBox.show) {\n\t\t\t\t\tthis.$refs.atBox.moveUp()\n\t\t\t\t}\n\t\t\t},\n\t\t\tonKeyEnter() {\n\t\t\t\tif (this.$refs.atBox.show) {\n\t\t\t\t\t// 键盘操作不会自动修正焦点，需要手动修正,原因不详\n\t\t\t\t\tthis.focusOffset += this.atSearchText.length;\n\t\t\t\t\tthis.$refs.atBox.select();\n\t\t\t\t} else {\n\t\t\t\t\tthis.sendMessage();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEditBoxBlur() {\n\t\t\t\tlet selection = window.getSelection()\n\t\t\t\t// 记录光标位置(点击emoji时)\n\t\t\t\tthis.focusNode = selection.focusNode;\n\t\t\t\tthis.focusOffset = selection.focusOffset;\n\t\t\t},\n\t\t\tonEditorInput(e) {\n\t\t\t\t// 如果触发 @\n\t\t\t\tif (this.chat.type == \"GROUP\" && !this.zhLock) {\n\t\t\t\t\tif (e.data == '@') {\n\t\t\t\t\t\t// 打开选择弹窗\n\t\t\t\t\t\tthis.showAtBox(e);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet selection = window.getSelection()\n\t\t\t\t\t\tlet range = selection.getRangeAt(0)\n\t\t\t\t\t\tthis.focusNode = selection.focusNode;\n\t\t\t\t\t\t// 截取@后面的名称作为过滤条件\n\t\t\t\t\t\tlet stIdx = this.focusNode.textContent.lastIndexOf('@');\n\t\t\t\t\t\tthis.atSearchText = this.focusNode.textContent.substring(stIdx + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tonEditorCompositionStart() {\n\t\t\t\tthis.zhLock = true;\n\t\t\t},\n\t\t\tonEditorCompositionEnd(e) {\n\t\t\t\tthis.zhLock = false;\n\t\t\t\tthis.onEditorInput(e);\n\t\t\t},\n\t\t\tshowAtBox(e) {\n\t\t\t\tthis.atSearchText = \"\";\n\t\t\t\tlet selection = window.getSelection()\n\t\t\t\tlet range = selection.getRangeAt(0)\n\t\t\t\t// 记录光标所在位置\n\t\t\t\tthis.focusNode = selection.focusNode;\n\t\t\t\tthis.focusOffset = selection.focusOffset;\n\t\t\t\t// 光标所在坐标\n\t\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\t\tthis.$refs.atBox.open({\n\t\t\t\t\tx: pos.x,\n\t\t\t\t\ty: pos.y\n\t\t\t\t})\n\t\t\t},\n\t\t\tonAtSelect(member) {\n\t\t\t\tlet range = window.getSelection().getRangeAt(0)\n\t\t\t\t// 选中输入的 @xx 符\n\t\t\t\trange.setStart(this.focusNode, this.focusOffset - 1 - this.atSearchText.length)\n\t\t\t\trange.setEnd(this.focusNode, this.focusOffset)\n\t\t\t\trange.deleteContents()\n\t\t\t\t// 创建元素节点\n\t\t\t\tlet element = document.createElement('SPAN')\n\t\t\t\telement.className = \"at\"\n\t\t\t\telement.dataset.id = member.userId;\n\t\t\t\telement.contentEditable = 'false'\n\t\t\t\telement.innerText = `@${member.aliasName}`\n\t\t\t\trange.insertNode(element)\n\t\t\t\t// 光标移动到末尾\n\t\t\t\trange.collapse()\n\t\t\t\t// 插入空格\n\t\t\t\tlet textNode = document.createTextNode('\\u00A0');\n\t\t\t\trange.insertNode(textNode)\n\t\t\t\trange.collapse()\n\t\t\t\tthis.atSearchText = \"\";\n\t\t\t\tthis.$refs.editBox.focus()\n\t\t\t},\n\t\t\tcreateSendText() {\n\t\t\t\tlet sendText = \"\"\n\t\t\t\tthis.$refs.editBox.childNodes.forEach((node) => {\n\t\t\t\t\tif (node.nodeName == \"#text\") {\n\t\t\t\t\t\tsendText += this.html2Escape(node.textContent);\n\t\t\t\t\t} else if (node.nodeName == \"SPAN\") {\n\t\t\t\t\t\tsendText += node.innerText;\n\t\t\t\t\t} else if (node.nodeName == \"IMG\") {\n\t\t\t\t\t\tsendText += node.dataset.code;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn sendText;\n\t\t\t},\n\t\t\thtml2Escape(strHtml) {\n\t\t\t\treturn strHtml.replace(/[<>&\"]/g, function(c) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'<': '&lt;',\n\t\t\t\t\t\t'>': '&gt;',\n\t\t\t\t\t\t'&': '&amp;',\n\t\t\t\t\t\t'\"': '&quot;'\n\t\t\t\t\t}[c];\n\t\t\t\t});\n\t\t\t},\n\t\t\tcreateAtUserIds() {\n\t\t\t\tlet ids = [];\n\t\t\t\tthis.$refs.editBox.childNodes.forEach((node) => {\n\t\t\t\t\tif (node.nodeName == \"SPAN\") {\n\t\t\t\t\t\tids.push(node.dataset.id);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn ids;\n\t\t\t},\n\t\t\tonEditorPaste(e) {\n\t\t\t\tlet txt = event.clipboardData.getData('Text')\n\t\t\t\tif (typeof(txt) == 'string') {\n\t\t\t\t\tlet range = window.getSelection().getRangeAt(0)\n\t\t\t\t\tlet textNode = document.createTextNode(txt);\n\t\t\t\t\trange.insertNode(textNode)\n\t\t\t\t\trange.collapse();\n\n\t\t\t\t}\n\t\t\t\tlet items = (event.clipboardData || window.clipboardData).items\n\t\t\t\tif (items.length) {\n\t\t\t\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\t\t\t\tif (items[i].type.indexOf('image') !== -1) {\n\t\t\t\t\t\t\tlet file = items[i].getAsFile();\n\t\t\t\t\t\t\tthis.sendImageFile = file;\n\t\t\t\t\t\t\tthis.sendImageUrl = URL.createObjectURL(file);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tremoveSendImage() {\n\t\t\t\tthis.sendImageUrl = \"\";\n\t\t\t\tthis.sendImageFile = null;\n\t\t\t},\n\t\t\tonImageSuccess(data, file) {\n\t\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\t\tmsgInfo.content = JSON.stringify(data);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: this.messageAction,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tdata: msgInfo\n\t\t\t\t}).then((id) => {\n\t\t\t\t\tmsgInfo.loadStatus = 'ok';\n\t\t\t\t\tmsgInfo.id = id;\n\t\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t})\n\t\t\t},\n\t\t\tonImageFail(e, file) {\n\t\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\t\tmsgInfo.loadStatus = 'fail';\n\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t},\n\t\t\tonImageBefore(file) {\n\t\t\t\tlet url = URL.createObjectURL(file);\n\t\t\t\tlet data = {\n\t\t\t\t\toriginUrl: url,\n\t\t\t\t\tthumbUrl: url\n\t\t\t\t}\n\t\t\t\tlet msgInfo = {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tfileId: file.uid,\n\t\t\t\t\tsendId: this.mine.id,\n\t\t\t\t\tcontent: JSON.stringify(data),\n\t\t\t\t\tsendTime: new Date().getTime(),\n\t\t\t\t\tselfSend: true,\n\t\t\t\t\ttype: 1,\n\t\t\t\t\tloadStatus: \"loading\",\n\t\t\t\t\tstatus: this.$enums.MESSAGE_STATUS.UNSEND\n\t\t\t\t}\n\t\t\t\t// 填充对方id\n\t\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t\t// 插入消息\n\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t// 滚动到底部\n\t\t\t\tthis.scrollToBottom();\n\t\t\t\t// 借助file对象保存\n\t\t\t\tfile.msgInfo = msgInfo;\n\t\t\t},\n\t\t\tonFileSuccess(url, file) {\n\t\t\t\tlet data = {\n\t\t\t\t\tname: file.name,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\turl: url\n\t\t\t\t}\n\t\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\t\tmsgInfo.content = JSON.stringify(data);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: this.messageAction,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tdata: msgInfo\n\t\t\t\t}).then((id) => {\n\t\t\t\t\tmsgInfo.loadStatus = 'ok';\n\t\t\t\t\tmsgInfo.id = id;\n\t\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t})\n\t\t\t},\n\t\t\tonFileFail(e, file) {\n\t\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\t\tmsgInfo.loadStatus = 'fail';\n\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t},\n\t\t\tonFileBefore(file) {\n\t\t\t\tlet url = URL.createObjectURL(file);\n\t\t\t\tlet data = {\n\t\t\t\t\tname: file.name,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\turl: url\n\t\t\t\t}\n\t\t\t\tlet msgInfo = {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tsendId: this.mine.id,\n\t\t\t\t\tcontent: JSON.stringify(data),\n\t\t\t\t\tsendTime: new Date().getTime(),\n\t\t\t\t\tselfSend: true,\n\t\t\t\t\ttype: 2,\n\t\t\t\t\tloadStatus: \"loading\",\n\t\t\t\t\tstatus: this.$enums.MESSAGE_STATUS.UNSEND\n\t\t\t\t}\n\t\t\t\t// 填充对方id\n\t\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t\t// 插入消息\n\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t// 滚动到底部\n\t\t\t\tthis.scrollToBottom();\n\t\t\t\t// 借助file对象透传\n\t\t\t\tfile.msgInfo = msgInfo;\n\t\t\t},\n\t\t\tonCloseSide() {\n\t\t\t\tthis.showSide = false;\n\t\t\t},\n\t\t\tonScrollToTop() {\n\t\t\t\t// 多展示10条信息\n\t\t\t\tthis.showMinIdx = this.showMinIdx > 10 ? this.showMinIdx - 10 : 0;\n\t\t\t},\n\t\t\tonScroll(e) {\n\t\t\t\tlet scrollElement = e.target\n\t\t\t\tlet scrollTop = scrollElement.scrollTop\n\t\t\t\tif (scrollTop < 30) { // 在顶部,不滚动的情况\n\t\t\t\t\t// 多展示20条信息\n\t\t\t\t\tthis.showMinIdx = this.showMinIdx > 20 ? this.showMinIdx - 20 : 0;\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowEmotionBox() {\n\t\t\t\tlet width = this.$refs.emotion.offsetWidth;\n\t\t\t\tlet left = this.$elm.fixLeft(this.$refs.emotion);\n\t\t\t\tlet top = this.$elm.fixTop(this.$refs.emotion);\n\t\t\t\tthis.$refs.emoBox.open({\n\t\t\t\t\tx: left + width / 2,\n\t\t\t\t\ty: top\n\t\t\t\t})\n\n\t\t\t},\n\t\t\tonEmotion(emoText) {\n\t\t\t\t// 保持输入框焦点\n\t\t\t\tthis.$refs.editBox.focus();\n\t\t\t\tlet range = window.getSelection().getRangeAt(0);\n\t\t\t\t// 插入光标所在位置\n\t\t\t\trange.setStart(this.focusNode, this.focusOffset)\n\t\t\t\tlet element = document.createElement('IMG')\n\t\t\t\telement.className = \"emo\"\n\t\t\t\telement.dataset.code = emoText;\n\t\t\t\telement.contentEditable = 'true'\n\t\t\t\telement.setAttribute(\"src\", this.$emo.textToUrl(emoText));\n\t\t\t\t// 选中元素节点\n\t\t\t\trange.insertNode(element)\n\t\t\t\t// 光标移动到末尾\n\t\t\t\trange.collapse()\n\n\t\t\t},\n\t\t\tshowVoiceBox() {\n\t\t\t\tthis.showVoice = true;\n\t\t\t},\n\t\t\tcloseVoiceBox() {\n\t\t\t\tthis.showVoice = false;\n\t\t\t},\n\t\t\tshowVideoBox() {\n\t\t\t\tthis.$store.commit(\"showChatPrivateVideoBox\", {\n\t\t\t\t\tfriend: this.friend,\n\t\t\t\t\tmaster: true\n\t\t\t\t});\n\t\t\t},\n\t\t\tshowHistoryBox() {\n\t\t\t\tthis.showHistory = true;\n\t\t\t},\n\t\t\tcloseHistoryBox() {\n\t\t\t\tthis.showHistory = false;\n\t\t\t},\n\t\t\tonSendVoice(data) {\n\t\t\t\tlet msgInfo = {\n\t\t\t\t\tcontent: JSON.stringify(data),\n\t\t\t\t\ttype: 3\n\t\t\t\t}\n\t\t\t\t// 填充对方id\n\t\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: this.messageAction,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tdata: msgInfo\n\t\t\t\t}).then((id) => {\n\t\t\t\t\tmsgInfo.id = id;\n\t\t\t\t\tmsgInfo.sendTime = new Date().getTime();\n\t\t\t\t\tmsgInfo.sendId = this.$store.state.userStore.userInfo.id;\n\t\t\t\t\tmsgInfo.selfSend = true;\n\t\t\t\t\tmsgInfo.status = this.$enums.MESSAGE_STATUS.UNSEND;\n\t\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t\t// 保持输入框焦点\n\t\t\t\t\tthis.$refs.editBox.focus();\n\t\t\t\t\t// 滚动到底部\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t// 关闭录音窗口\n\t\t\t\t\tthis.showVoice = false;\n\t\t\t\t})\n\t\t\t},\n\t\t\tfillTargetId(msgInfo, targetId) {\n\t\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\t\tmsgInfo.groupId = targetId;\n\t\t\t\t} else {\n\t\t\t\t\tmsgInfo.recvId = targetId;\n\t\t\t\t}\n\t\t\t},\n\t\t\tsendMessage() {\n\t\t\t\tif (this.sendImageFile) {\n\t\t\t\t\tthis.sendImageMessage();\n\t\t\t\t} else {\n\t\t\t\t\tthis.sendTextMessage();\n\t\t\t\t}\n\t\t\t\t// 消息已读\n\t\t\t\tthis.readedMessage()\n\t\t\t},\n\t\t\tsendImageMessage() {\n\t\t\t\tlet file = this.sendImageFile;\n\t\t\t\tthis.onImageBefore(this.sendImageFile);\n\t\t\t\tlet formData = new FormData()\n\t\t\t\tformData.append('file', file)\n\t\t\t\tthis.$http.post(\"/image/upload\", formData, {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((data) => {\n\t\t\t\t\tthis.onImageSuccess(data, file);\n\t\t\t\t}).catch((res) => {\n\t\t\t\t\tthis.onImageSuccess(res, file);\n\t\t\t\t})\n\t\t\t\tthis.sendImageFile = null;\n\t\t\t\tthis.sendImageUrl = \"\";\n\t\t\t\tthis.$nextTick(() => this.$refs.editBox.focus());\n\t\t\t\tthis.scrollToBottom();\n\t\t\t},\n\t\t\tsendTextMessage() {\n\t\t\t\tlet sendText = this.createSendText();\n\t\t\t\tif (!sendText.trim()) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.$refs.editBox.cle\n\t\t\t\tlet msgInfo = {\n\t\t\t\t\tcontent: sendText,\n\t\t\t\t\ttype: 0\n\t\t\t\t}\n\t\t\t\t// 填充对方id\n\t\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t\t// 被@人员列表\n\t\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\t\tmsgInfo.atUserIds = this.createAtUserIds();\n\t\t\t\t}\n\t\t\t\tthis.lockMessage = true;\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: this.messageAction,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\tdata: msgInfo\n\t\t\t\t}).then((id) => {\n\t\t\t\t\tmsgInfo.id = id;\n\t\t\t\t\tmsgInfo.sendTime = new Date().getTime();\n\t\t\t\t\tmsgInfo.sendId = this.$store.state.userStore.userInfo.id;\n\t\t\t\t\tmsgInfo.selfSend = true;\n\t\t\t\t\tmsgInfo.status = this.$enums.MESSAGE_STATUS.UNSEND;\n\t\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t}).finally(() => {\n\t\t\t\t\t// 解除锁定\n\t\t\t\t\tthis.lockMessage = false;\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\tthis.resetEditor();\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tdeleteMessage(msgInfo) {\n\t\t\t\tthis.$confirm('确认删除消息?', '删除消息', {\n\t\t\t\t\tconfirmButtonText: '确定',\n\t\t\t\t\tcancelButtonText: '取消',\n\t\t\t\t\ttype: 'warning'\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.$store.commit(\"deleteMessage\", msgInfo);\n\t\t\t\t});\n\t\t\t},\n\t\t\trecallMessage(msgInfo) {\n\t\t\t\tthis.$confirm('确认撤回消息?', '撤回消息', {\n\t\t\t\t\tconfirmButtonText: '确定',\n\t\t\t\t\tcancelButtonText: '取消',\n\t\t\t\t\ttype: 'warning'\n\t\t\t\t}).then(() => {\n\t\t\t\t\tlet url = `/message/${this.chat.type.toLowerCase()}/recall/${msgInfo.id}`\n\t\t\t\t\tthis.$http({\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tmethod: 'delete'\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.$message.success(\"消息已撤回\");\n\t\t\t\t\t\tmsgInfo = JSON.parse(JSON.stringify(msgInfo));\n\t\t\t\t\t\tmsgInfo.type = 10;\n\t\t\t\t\t\tmsgInfo.content = '你撤回了一条消息';\n\t\t\t\t\t\tmsgInfo.status = this.$enums.MESSAGE_STATUS.RECALL;\n\t\t\t\t\t\tthis.$store.commit(\"insertMessage\", msgInfo);\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t},\n\t\t\treadedMessage() {\n\t\t\t\tif (this.chat.unreadCount == 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.commit(\"resetUnreadCount\", this.chat)\n\t\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\t\tvar url = `/message/group/readed?groupId=${this.chat.targetId}`\n\t\t\t\t} else {\n\t\t\t\t\turl = `/message/private/readed?friendId=${this.chat.targetId}`\n\t\t\t\t}\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: url,\n\t\t\t\t\tmethod: 'put'\n\t\t\t\t}).then(() => {})\n\t\t\t},\n\t\t\tloadReaded(fId) {\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: `/message/private/maxReadedId?friendId=${fId}`,\n\t\t\t\t\tmethod: 'get'\n\t\t\t\t}).then((id) => {\n\t\t\t\t\tthis.$store.commit(\"readedMessage\", {\n\t\t\t\t\t\tfriendId: fId,\n\t\t\t\t\t\tmaxId: id\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tloadGroup(groupId) {\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: `/group/find/${groupId}`,\n\t\t\t\t\tmethod: 'get'\n\t\t\t\t}).then((group) => {\n\t\t\t\t\tthis.group = group;\n\t\t\t\t\tthis.$store.commit(\"updateChatFromGroup\", group);\n\t\t\t\t\tthis.$store.commit(\"updateGroup\", group);\n\n\t\t\t\t});\n\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: `/group/members/${groupId}`,\n\t\t\t\t\tmethod: 'get'\n\t\t\t\t}).then((groupMembers) => {\n\t\t\t\t\tthis.groupMembers = groupMembers;\n\t\t\t\t});\n\t\t\t},\n\t\t\tloadFriend(friendId) {\n\t\t\t\t// 获取对方最新信息\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: `/user/find/${friendId}`,\n\t\t\t\t\tmethod: 'get'\n\t\t\t\t}).then((friend) => {\n\t\t\t\t\tthis.friend = friend;\n\t\t\t\t\tthis.$store.commit(\"updateChatFromFriend\", friend);\n\t\t\t\t\tthis.$store.commit(\"updateFriend\", friend);\n\t\t\t\t})\n\t\t\t},\n\t\t\tshowName(msgInfo) {\n\t\t\t\tif (this.chat.type == 'GROUP') {\n\t\t\t\t\tlet member = this.groupMembers.find((m) => m.userId == msgInfo.sendId);\n\t\t\t\t\treturn member ? member.aliasName : \"\";\n\t\t\t\t} else {\n\t\t\t\t\treturn msgInfo.sendId == this.mine.id ? this.mine.nickName : this.chat.showName\n\t\t\t\t}\n\n\t\t\t},\n\t\t\theadImage(msgInfo) {\n\t\t\t\tif (this.chat.type == 'GROUP') {\n\t\t\t\t\tlet member = this.groupMembers.find((m) => m.userId == msgInfo.sendId);\n\t\t\t\t\treturn member ? member.headImage : \"\";\n\t\t\t\t} else {\n\t\t\t\t\treturn msgInfo.sendId == this.mine.id ? this.mine.headImageThumb : this.chat.headImage\n\t\t\t\t}\n\t\t\t},\n\t\t\tresetEditor() {\n\t\t\t\tthis.sendImageUrl = \"\";\n\t\t\t\tthis.sendImageFile = null;\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.$refs.editBox.innerHTML = \"\";\n\t\t\t\t\tthis.$refs.editBox.focus();\n\t\t\t\t});\n\t\t\t},\n\t\t\tscrollToBottom() {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tlet div = document.getElementById(\"chatScrollBox\");\n\t\t\t\t\tdiv.scrollTop = div.scrollHeight;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tmine() {\n\t\t\t\treturn this.$store.state.userStore.userInfo;\n\t\t\t},\n\t\t\ttitle() {\n\t\t\t\tlet title = this.chat.showName;\n\t\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\t\tlet size = this.groupMembers.filter(m => !m.quit).length;\n\t\t\t\t\ttitle += `(${size})`;\n\t\t\t\t}\n\t\t\t\treturn title;\n\t\t\t},\n\t\t\tmessageAction() {\n\t\t\t\treturn `/message/${this.chat.type.toLowerCase()}/send`;\n\t\t\t},\n\t\t\tunreadCount() {\n\t\t\t\treturn this.chat.unreadCount;\n\t\t\t}\n\t\t},\n\t\twatch: {\n\t\t\tchat: {\n\t\t\t\thandler(newChat, oldChat) {\n\t\t\t\t\tif (newChat.targetId > 0 && (!oldChat || newChat.type != oldChat.type ||\n\t\t\t\t\t\t\tnewChat.targetId != oldChat.targetId)) {\n\t\t\t\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\t\t\t\tthis.loadGroup(this.chat.targetId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.loadFriend(this.chat.targetId);\n\t\t\t\t\t\t\t// 加载已读状态\n\t\t\t\t\t\t\tthis.loadReaded(this.chat.targetId)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 滚到底部\n\t\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t\tthis.showSide = false;\n\t\t\t\t\t\t// 消息已读\n\t\t\t\t\t\tthis.readedMessage()\n\t\t\t\t\t\t// 初始状态只显示30条消息\n\t\t\t\t\t\tlet size = this.chat.messages.length;\n\t\t\t\t\t\tthis.showMinIdx = size > 30 ? size - 30 : 0;\n\t\t\t\t\t\t// 重置输入框\n\t\t\t\t\t\tthis.resetEditor();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\timmediate: true\n\t\t\t},\n\t\t\tunreadCount: {\n\t\t\t\thandler(newCount, oldCount) {\n\t\t\t\t\tif (newCount > 0) {\n\t\t\t\t\t\t// 拉至底部\n\t\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tlet div = document.getElementById(\"chatScrollBox\");\n\t\t\tdiv.addEventListener('scroll', this.onScroll)\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n.header{\n\tcolor: rgb(152, 152, 152);\n\tletter-spacing: 1px;\n\n\nbackground-image: linear-gradient(0deg, rgb(253, 250, 250), #e2e9f7);\n}\n\t.chat-box {\n\t\tfont-family: Calibri, sans-serif;\n\t\tposition: relative;\n\t\twidth: 100%;\n\t\tbackground-image: url(\"../../assets/image/输入框背景.jpg\");\n\t\tbackground-size: cover;\n\t\tbackground-position: center;\n\n\t\t.el-header {\n\t\t\tpadding: 5px;\n\t\t\tbackground-color: white;\n\t\t\tline-height: 50px;\n\t\t\tfont-size: 20px;\n\t\t\tfont-weight: 600;\n\t\t\t// border: #dddddd solid 1px;\n\t\t\t// box-shadow: 3px 1px 3px #222222b0;\n\n\t\t\t.btn-side {\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 20px;\n\t\t\t\tline-height: 60px;\n\t\t\t\tfont-size: 22px;\n\t\t\t\tcursor: pointer;\n\n\t\t\t\t&:hover {\n\t\t\t\t\tfont-size: 30px;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t.im-chat-main {\n\t\t\tpadding: 0;\n\t\t\t// border: #dddddd solid 1px;\n\n\t\t\t.im-chat-box {\n\t\t\t\t>ul {\n\t\t\t\t\tpadding: 0 20px;\n\n\t\t\t\t\tli {\n\t\t\t\t\t\tlist-style-type: none;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.im-chat-footer {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tpadding: 0;\n\t\t\t// border: #dddddd solid 1px;\n\n\t\t\t.chat-tool-bar {\n\n\t\t\t\tdisplay: flex;\n\t\t\t\tposition: relative;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 50px;\n\t\t\t\ttext-align: left;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\tborder-top: 1px solid #ddd;\n\t\t\t\tpadding: 5px;\n\n\t\t\t\t>div {\n\t\t\t\t\tmargin-left: 20px;\n\t\t\t\t\tfont-size: 35px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tcolor: #8b8b8b;\n\t\t\t\t\tline-height: 40px;\n\n\t\t\t\t\t&:hover {\n\t\t\t\t\t\tcolor: black;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.send-content-area {\n\t\t\t\tposition: relative;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\theight: 100%;\n\t\t\t\tbackground-color: white !important;\n\n\n\t\t\t\t.send-text-area {\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tpadding: 5px;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tresize: none;\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\tcolor: black;\n\t\t\t\t\toutline-color: rgba(219, 235, 249, 0.61);\n\n\t\t\t\t\ttext-align: left;\n\t\t\t\t\tline-height: 30 px;\n\n\t\t\t\t\t.at {\n\t\t\t\t\t\tcolor: blue;\n\t\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\t}\n\n\t\t\t\t\t.emo {\n\t\t\t\t\t\twidth: 30px;\n\t\t\t\t\t\theight: 30px;\n\t\t\t\t\t\tvertical-align: bottom;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.send-image-area {\n\t\t\t\t\ttext-align: left;\n\t\t\t\t\tborder: #53a0e7 solid 1px;\n\n\t\t\t\t\t.send-image-box {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\tdisplay: inline-block;\n\n\t\t\t\t\t\t.send-image {\n\t\t\t\t\t\t\tmax-height: 180px;\n\t\t\t\t\t\t\tborder: 1px solid #ccc;\n\t\t\t\t\t\t\tborder-radius: 2%;\n\t\t\t\t\t\t\tmargin: 2px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.send-image-close {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\tpadding: 3px;\n\t\t\t\t\t\t\tright: 7px;\n\t\t\t\t\t\t\ttop: 7px;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\tfont-size: 15px;\n\t\t\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\t\t\tbackground-color: #aaa;\n\t\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\t\tborder: 1px solid #ccc;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t.send-btn-area {\n\t\t\t\t\tpadding: 10px;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\t.chat-group-side-box {\n\t\t\tborder: #dddddd solid 1px;\n\t\t\tanimation: rtl-drawer-in .3s 1ms;\n\t\t}\n\t}\n</style>"]}]}